{"device":"DESKTOP","widgets":{"productsTable":{"t":"Table","lX":12,"lY":81,"sX":5.19,"sY":5.14,"s":"Manage Products","ps":{"enabled":true,"scalingType":"OK","width":"41.12%","height":"70.8%","x":"0.97%","y":"11.37%"},"ver":"190104c210519","dis":false,"tt":"","a":{"text color":"#000000","row color":"#000000","columns":"name,expiry,weight per block","selectable":"multi","display header":"true","title":"All Products","form id":"products","form key":"all","enable search":"true","colWidths":"0.3036750483558994,0.2978723404255319,0.30174081237911027","auto scroll":"false"},"ev":{"clientEvents":{"inputEvents":{"New Event #1":{"channel":"masterDelRows/delete all rows","event":"delete all rows","important":"false"}},"outputEvents":{}}}},"companyProductsTable":{"t":"Table","lX":623,"lY":82,"sX":6.12,"sY":5.14,"s":"Manage Products","ps":{"enabled":true,"scalingType":"OK","width":"48.47%","height":"70.8%","x":"49.9%","y":"11.55%"},"ver":"190104c210519","dis":false,"tt":"","a":{"columns":"name,created on,created by,expiry,weight per block","selectable":"multi + single","text color":"#000000","row color":"#000000","display header":"true","title":"Company Products","form id":"products","form key":"company","enable search":"true","colWidths":"0.18524590163934426,0.1819672131147541,0.18360655737704917,0.1819672131147541,0.18524590163934426"},"ev":{"clientEvents":{"inputEvents":{"Delete Rows":{"channel":"compDelRows/delete all rows","event":"delete all rows","important":"false"}},"outputEvents":{"Select Row":{"channel":"selectCompRow/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"Scripting#6":{"t":"Scripting","lX":305,"lY":1195,"sX":1,"sY":1,"s":"Manage Products","ps":{"enabled":false,"scalingType":"OK","width":"9.07%","height":"8.26%","x":"7.25%","y":"66.47%"},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","file name":"../../js/settings/manage products/manageProducts.js","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\n var productCollection;\n var compProductCollection;\n var currentCompany;\n \n const productsTable = Script.getWidget(\"productsTable\");\n const compProductsTable = Script.getWidget(\"companyProductsTable\");\n const compDropdown = Script.getWidget(\"companyDropdown\");\n\nScript.on(\"init\", function() {\n\tClient.setScreenVisible(\"Edit Product\", false);\n\tClient.setScreenVisible(\"Edit User Role\", false);\n\tClient.setScreenVisible(\"Edit Error Codes\", false);\n\tClient.setScreenVisible(\"Edit Company\", false);\n\tClient.setScreenVisible(\"Edit Application Settings\", false);\n\tClient.setScreenVisible(\"Edit Model Type\", false);\n\tClient.setScreenVisible(\"Edit Model\", false);\n\tClient.setScreenVisible(\"Edit User Access Role\", false);\n});\n \n Script.on('load', function() {\n\t Database.readRecords(\"rodent\", \"Companies\", function(eventData) {\n\t\t let companyCollection = SensaCollection.load(eventData.value);\n \n\t\t Database.readRecords(\"rodent\", \"UserRoles\", function(eventData) {\n\t\t\t let userCollection = SensaCollection.load(eventData.value);\n\t\t\t let filteredUsers = userCollection.query((record, pk) => {\n\t\t\t\t if (record['User'] == Client.getUser()) {\n\t\t\t\t\t return true;\n\t\t\t\t }\n\t\t\t });\n\t\t\t var userCompanies = filteredUsers.getColumn(\"CompanyId\");\n \n\t\t\t let filteredCompanies = companyCollection.query((record, pk) => {\n\t\t\t\t if (userCompanies.includes(pk)) {\n\t\t\t\t\t return true;\n\t\t\t\t }\n\t\t\t });\n \n\t\t\t let compNames = filteredCompanies.getColumn(\"Name\");\n\t\t\t let compLoc = filteredCompanies.getColumn(\"Address\");\n\t\t\t let compIds = filteredCompanies.getColumn(\"Id\");\n\t \n\t\t\t // Get from state if coming back from editing/creating\n\t\t\t currentCompany = Script.getState(\"currentCompany\");\n\t\t\t if (currentCompany == null) {\n\t\t\t\t currentCompany = compIds[0];\n\t\t\t }\n\t\t\t \n \n\t\t\t let compObj = {};\n\t\t\t compIds.map((comp, idx) => {\n\t\t\t\t compObj[comp] = compNames[idx] + \", \" + compLoc[idx];\n\t\t\t });\n \n\t\t\t Object.keys(compObj).forEach((comp, idx) => {\n\t\t\t\t filteredCompanies.set({\"Id\": comp, \"Name\": compObj[comp]});\n\t\t\t });\n \n\t\t\t filteredCompanies.renameColumn(\"Name\", \"text\");\n\t\t\t filteredCompanies.renameColumn(\"Id\", \"value\");\n \n\t\t\t compDropdown.receiveTextValues(filteredCompanies);\n\t\t\t compDropdown.receiveValue(compObj[currentCompany]);\n\t\t\t \n\t\t\t Database.readRecords(\"rodent\", \"CompanyProducts\", function(eventData) {\n\t\t\t\t compProductCollection = SensaCollection.load(eventData.value);\n\t\t\t\t updateTable();\n\t\t\t });\n\t\t });\n\t });\n\t \n\t Database.readRecords(\"rodent\", \"Products\", function(eventData) {\n\t\t productCollection = SensaCollection.load(eventData.value);\n\t\t let filteredComps = productCollection.query((record, pk) => {\n\t\t\t if (record['Status'] == '1'){\n\t\t\t\t return true;\n\t\t\t }\n\t\t });\n\t\t ClientEvents.publish(\"masterDelRows\", \"\");\n\t\t productsTable.receiveValue(filteredComps);\n\t });\n });\n \n ClientEvents.subscribe(\"addCompanyProducts\", addProductToCompany);\n ClientEvents.subscribe(\"removeCompanyProducts\", removeProductFromCompany);\n ClientEvents.subscribe(\"compSelected\", changeCompany);\n ClientEvents.subscribe(\"selectCompRow\", editProduct);\n ClientEvents.subscribe(\"newProdIcon\", createNewProduct);\n \n function addProductToCompany() {\n\t var formData = Script.getFormByKey(\"products\");\n\t var compData = formData.all;\n\t compData.addColumn(\"companyid\");\n\t \n\t var dbReq = {};\n\t var compProdCount = Object.keys(compProductCollection.data).length;\n\t let today = new Date();\n\t today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n\t \n\t compData.forEach(function(kvpair, pk) {\n\t\t var prodObj = {};\n\t\t // Check if product already exists with status = 0\n\t\t let matchingProd = compProductCollection.query((record, pk) => {\n\t\t\t if ((record['CompanyId'] == Script.getFormByKey(\"products\").compDrop) &&\n\t\t\t\t (record['Name'] == kvpair.name) &&\n\t\t\t\t (record['Expiry'] == kvpair.expiry) &&\n\t\t\t\t (record['WeightPerBlock'] == kvpair.weightperblock) &&\n\t\t\t\t (record['Status'] == '0')) {\n\t\t\t\t return true;\n\t\t\t }\n\t\t });\n\t\t if (Object.keys(matchingProd.data).length > 0) {\n\t\t\t // found match, override\n\t\t\t prodObj.Id = Object.keys(matchingProd.data)[0];\n\t\t\t \n\t\t } else {\n\t\t\t prodObj.Id = `${++compProdCount}`;\n\t\t }\n\t\t prodObj.Name = kvpair.name;\n\t\t prodObj.Owner = kvpair.owner;\n\t\t prodObj.Status = kvpair.status;\n\t\t prodObj.CreatedOn = today;\n\t\t prodObj.UpdatedOn = today;\n\t\t prodObj.CreatedBy = Client.getUser();\n\t\t prodObj.UpdatedBy = Client.getUser();\n\t\t prodObj.CompanyId = formData.compDrop;\n\t\t prodObj.Expiry = kvpair.expiry;\n\t\t prodObj.LowerThreshold = kvpair.lowerthreshold;\n\t\t prodObj.UpperThreshold = kvpair.upperthreshold;\n\t\t prodObj.WeightPerBlock = kvpair.weightperblock;\n\t\t dbReq[prodObj.Id] = prodObj;\n\t });\n\t Database.saveRecord(\"rodent\", \"CompanyProducts\", dbReq, () => {\n\t\t Database.readRecords(\"rodent\", \"CompanyProducts\", function(eventData) {\n\t\t\t compProductCollection = SensaCollection.load(eventData.value);\n\t\t\t updateTable();\n\t\t });\n\t });\n }\n \n function updateTable() {\n\t let filteredComps = compProductCollection.query((record, pk) => {\n\t\t if ((record['CompanyId'] == currentCompany) &&\n\t\t\t (record['Status'] == '1')){\n\t\t\t return true;\n\t\t }\n\t });\n \n\t ClientEvents.publish(\"compDelRows\", \"\");\n\t compProductsTable.receiveValue(filteredComps);\n }\n \n function removeProductFromCompany() {\n\t var formData = Script.getFormByKey(\"products\");\n\t var ids = formData.company.getColumn(\"id\");\n\t for (var i = 0; i < ids.length; i++) {\n\t\t compProductsTable.deleteRows(ids[i]);\n\t\t let req = {};\n\t\t req[{\"Id\": ids[i], \"Status\": \"0\"}] = {\"Id\": ids[i], \"Status\": \"0\"};\n\t\t Database.updateRecord(\"rodent\", \"CompanyProducts\", req);\n\t }\n }\n \n async function changeCompany(selected) {\n\t currentCompany = selected.value;\n\t \n\t Database.readRecords(\"rodent\", \"CompanyProducts\", function(eventData) {\n\t\t compProductCollection = SensaCollection.load(eventData.value);\n\t\t Script.setState(\"currentCompany\", currentCompany);\n\t\t updateTable();\n\t });\n }\n \n function editProduct(eventData) {\n\t Script.setState(\"compProductInfo\", eventData.value);\n\t Script.setState(\"modifyType\", \"edit\");\n\t Client.jumpToScreen(\"Edit Product\");\n }\n \n function createNewProduct(eventData) {\n\t Script.setState(\"modifyType\", \"add\");\n\t Script.setState(\"companyId\", currentCompany);\n\t Client.jumpToScreen(\"Edit Product\");\n }"},"ev":{}},"Icon#0":{"t":"Icon","lX":12,"lY":606,"sX":1.09,"sY":1.09,"s":"Manage Products","ps":{"enabled":true,"scalingType":"NOHORIZ,NOVERT","width":"4.31%","height":"7.44%","x":"0.97%","y":"85.25%"},"ver":"200628c210519","dis":false,"tt":"","a":{"outline color":"no outline","icon file":"plus-square"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"newProdIcon/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"Label#1":{"t":"Label","lX":74,"lY":618,"sX":6.32,"sY":2,"s":"Manage Products","ps":{"enabled":true,"scalingType":"OK","width":"50.02%","height":"50px","x":"5.9%","y":"86.97%"},"ver":"200124c210519","dis":false,"tt":"","a":{"font size":"14","label text":"New Company Product"},"ev":{}},"Button#3":{"t":"Button","lX":548,"lY":176,"sX":0.53,"sY":0.59,"s":"Manage Products","ps":{"enabled":true,"scalingType":"OK","width":"4.2%","height":"3.73%","x":"43.9%","y":"24.75%"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":">>","color":"grey"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"addCompanyProducts/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"Button#4":{"t":"Button","lX":548,"lY":234,"sX":0.53,"sY":0.59,"s":"Manage Products","ps":{"enabled":true,"scalingType":"OK","width":"4.2%","height":"3.73%","x":"43.9%","y":"32.92%"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":"<<","color":"grey"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"removeCompanyProducts/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"companyDropdown":{"t":"Dropdown","lX":1658,"lY":44,"sX":3.6,"sY":1,"s":"Manage Products","ps":{"enabled":true,"scalingType":"NOVERT","width":"28.49%","height":"4.19%","x":"70%","y":"3.53%"},"ver":"190104c210519","dis":false,"tt":"","a":{"label text":"Company","default options":"","form id":"products","form key":"compDrop"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"compSelected/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"Container#1":{"t":"Container","lX":0,"lY":11,"sX":12.59,"sY":6.67,"s":"Manage Products","ps":{"enabled":true,"scalingType":"OK","width":"99.66%","height":"91.81%","x":"0%","y":"1.58%"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"title":"Manage Company Products","color":"grey"},"ev":{}},"Scripting#8":{"t":"Scripting","lX":755,"lY":385,"sX":1,"sY":1,"s":"Edit Product","ps":{"enabled":"false","scalingType":"OK","width":"","height":"","x":"","y":""},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\nvar prodId;\nvar modifyType;\nconst prodFormContainer = Script.getWidget(\"productFormContainer\");\nconst prodSubmitButton = Script.getWidget(\"prodSubmitButton\");\nconst cancelProduct = Script.getWidget(\"cancelProduct\");\nScript.on('load', function() {\n\t\n\tcancelProduct.subscribe(\"pressed\", () => {\n\t\tClient.jumpToScreen(\"Manage Products\");\n\t});\n\tmodifyType = Script.getState(\"modifyType\");\n\tif (!modifyType) {\n\t\tClient.jumpToScreen(\"Manage Products\");\n\t}\n\tvar productData;\n\t\n\tif (modifyType.startsWith(\"add\")) {\n\t\tprodFormContainer.setTitle(\"New Product\");\n\t\treturn;\n    } else if (modifyType == \"edit\") {\n\t\tproductData = Script.getState(\"compProductInfo\");\n    } else if (modifyType == \"edit_master\") {\n\t\tproductData = Script.getState(\"productInfo\");\t   \n    }\n\tvar prodObj = {}\n\tprodId = productData.getColumn(\"id\")[0];\n\tprodObj.Name = productData.getColumn(\"name\");\n\tprodObj.Status = productData.getColumn(\"status\");\n\tprodObj.WeightPerBlock = productData.getColumn(\"weightperblock\");\n\tprodObj.Expiry = productData.getColumn(\"expiry\");\n\n\tScript.setForm(\"editProduct\", prodObj);\n\tprodFormContainer.setTitle(\"Edit Product\");\n});\n\nClientEvents.subscribe(\"finishEditProduct\", function() {\n\tswitch (modifyType) {\n\t\tcase 'edit':\n\t\t\thandleEdit();\n\t\t\tbreak;\n\t\tcase 'edit_master':\n\t\t\thandleEditMaster();\n\t\t\tbreak;\n\t\tcase 'add':\n\t\t\thandleCreate();\n\t\t\tbreak;\n\t\tcase 'add_master':\n\t\t\thandleCreateMaster();\n\t\t\tbreak;\n\t}\n});\n\nfunction handleEdit() {\n\tvar formObj = Script.getFormByKey(\"editProduct\");\n\tif (formObj == undefined) {\n\t\talert(\"Please fill out all required fields\");\n\t\treturn;\n\t}\n\t\t\n\tvar dbReq = {};\n\tvar companyProducts = Script.getState(\"companyProducts\");\n\tformObj.Id = prodId;\n\tformObj.Status = +formObj.Status;\n\tlet today = new Date();\n\ttoday = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n\tformObj.UpdatedOn = today;\n\tformObj.UpdatedBy = Client.getUser();\n\tdbReq[prodId] = formObj;\n\t\t\n\tDatabase.updateRecord(\"rodent\", \"CompanyProducts\", dbReq, () => {\n\t\t//Script.setState(\"currentCompany\", formObj.CompanyId);\n\t\tClient.jumpToScreen(\"Manage Products\");\n\t});\n}\n\nfunction handleEditMaster() {\n\tvar formObj = Script.getFormByKey(\"editProduct\");\n\tif (formObj == undefined) {\n\t\talert(\"Please fill out all required fields\");\n\t\treturn;\n\t}\n\t\t\n\tvar dbReq = {};\n\tformObj.Id = prodId;\n\tformObj.Status = +formObj.Status;\n\tlet today = new Date();\n\ttoday = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n\tformObj.UpdatedOn = today;\n\tformObj.UpdatedBy = Client.getUser();\n\tdbReq[prodId] = formObj;\n\t\t\n\tDatabase.updateRecord(\"rodent\", \"Products\", dbReq, () => {\n\t\tClient.jumpToScreen(\"Manage Master Products\");\n\t});\t\n}\n\nfunction handleCreate() {\n\tDatabase.readRecords(\"rodent\", \"CompanyProducts\", function(eventData) {\n\t\tvar compProductCollection = SensaCollection.load(eventData.value);\n\t\tvar formObj = Script.getFormByKey(\"editProduct\");\n\t\t\n\t\tif (formObj == undefined) {\n\t\t\talert(\"Please fill out all required fields\");\n\t\t\treturn;\n\t\t}\n\n\t\tvar dbReq = {};\n\t\tvar compProdCount = Object.keys(compProductCollection.data).length;\n\t\tformObj.Id = `${compProdCount + 1}`;\n\t\tformObj.Status = +formObj.Status;\n\n\t\tlet today = new Date();\n\t\ttoday = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n\t\tformObj.CreatedOn = today;\n\t\tformObj.UpdatedOn = today;\n\t\tformObj.Owner = Client.getUser();\n\t\tformObj.CreatedBy = Client.getUser();\n\t\tformObj.UpdatedBy = Client.getUser();\n\t\tformObj.CompanyId = Script.getState(\"companyId\");\n\t\tdbReq[compProdCount + 1] = formObj;\n\n\t\tDatabase.createRecords(\"rodent\", \"CompanyProducts\", dbReq, () => {\n\t\t\tScript.setState(\"currentCompany\", formObj.CompanyId);\n\t\t\tClient.jumpToScreen(\"Manage Products\");\n\t\t});\n\t});\n}\n\nfunction handleCreateMaster() {\n\tDatabase.readRecords(\"rodent\", \"Products\", function(eventData) {\n\t\tvar productCollection = SensaCollection.load(eventData.value);\n\t\tvar formObj = Script.getFormByKey(\"editProduct\");\n\t\t\n\t\tif (formObj == undefined) {\n\t\t\talert(\"Please fill out all required fields\");\n\t\t\treturn;\n\t\t}\n\n\t\tvar dbReq = {};\n\t\tvar compProdCount = Object.keys(productCollection.data).length;\n\t\tformObj.Id = `${compProdCount + 1}`;\n\t\tformObj.Status = +formObj.Status;\n\n\t\tlet today = new Date();\n\t\ttoday = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n\t\tformObj.CreatedOn = today;\n\t\tformObj.UpdatedOn = today;\n\t\tformObj.Owner = Client.getUser();\n\t\tformObj.CreatedBy = Client.getUser();\n\t\tformObj.UpdatedBy = Client.getUser();\n\t\tdbReq[compProdCount + 1] = formObj;\n\n\t\tDatabase.createRecords(\"rodent\", \"Products\", dbReq, () => {\n\t\t\tClient.jumpToScreen(\"Manage Master Products\");\n\t\t});\n\t});\n}"},"ev":{}},"Input#2":{"t":"Input","lX":70,"lY":213,"sX":5.03,"sY":1,"s":"Edit Product","ps":{"enabled":"true","scalingType":"NOVERT","width":"39.83%","height":"7.3%","x":"5.54%","y":"30.02%"},"ver":"270520c210519","dis":false,"tt":"","a":{"label text":"Name","color":"grey","form id":"editProduct","form key":"Name","required":"true"},"ev":{}},"Input#4":{"t":"Input","lX":70,"lY":286,"sX":5.03,"sY":1,"s":"Edit Product","ps":{"enabled":"true","scalingType":"NOVERT","width":"39.83%","height":"7.3%","x":"5.54%","y":"40.17%"},"ver":"270520c210519","dis":false,"tt":"","a":{"type":"number","label text":"Weight Per Block","color":"grey","form id":"editProduct","form key":"WeightPerBlock","required":"true"},"ev":{}},"Input#5":{"t":"Input","lX":70,"lY":293,"sX":5.03,"sY":1,"s":"Edit Product","ps":{"enabled":"true","scalingType":"NOVERT","width":"39.83%","height":"7.3%","x":"5.54%","y":"50.41%"},"ver":"270520c210519","dis":false,"tt":"","a":{"label text":"Expiry","color":"grey","type":"number","form id":"editProduct","form key":"Expiry","required":"true"},"ev":{}},"Input#6":{"t":"Input","lX":108,"lY":432,"sX":1.14,"sY":1,"s":"Edit Product","ps":{"enabled":"true","scalingType":"NOVERT","width":"9.03%","height":"7.3%","x":"5.58%","y":"59.5%"},"ver":"270520c210519","dis":false,"tt":"","a":{"type":"checkbox","label text":"Enabled","color":"grey","checkbox label side":"right","form id":"editProduct","form key":"Status","default value":"1"},"ev":{}},"productFormContainer":{"t":"Container","lX":70,"lY":155,"sX":5.06,"sY":3.52,"s":"Edit Product","ps":{"enabled":"true","scalingType":"OK","width":"40.06%","height":"48.55%","x":"5.54%","y":"21.35%"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"color":"grey","title":"Edit Product"},"ev":{}},"prodSubmitButton":{"t":"Button","lX":433,"lY":432,"sX":1.26,"sY":1,"s":"Edit Product","ps":{"enabled":"true","scalingType":"OK","width":"9.98%","height":"6.34%","x":"34.5%","y":"59.5%"},"ver":"190104c210519","dis":false,"tt":"","a":{"color":"orange strong","button name":"Submit"},"ev":{"clientEvents":{"inputEvents":{},"outputEvents":{"submitEdit":{"channel":"finishEditProduct/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"Scripting#9":{"t":"Scripting","lX":55,"lY":885,"sX":1,"sY":1,"s":"Manage Master Products","ps":{"enabled":"false","scalingType":"OK","width":"9.07%","height":"8.26%","x":"4.99%","y":"73.08%"},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\nvar productCollection;\n// Default\nvar status = \"Show Active\";\n\nconst productsTable = Script.getWidget(\"masterProductsTable\");\n\nScript.on('load', function() {\n\t\n\tDatabase.readRecords(\"rodent\", \"Products\", function(eventData) {\n\t\tproductCollection = SensaCollection.load(eventData.value);\n\t\tupdateTable();\n\t});\n});\n\nClientEvents.subscribe(\"productSelected\", editProduct);\nClientEvents.subscribe(\"removeMasterProducts\", removeProductFromCompany);\nClientEvents.subscribe(\"addNewMasterProduct\", createNewProduct);\nClientEvents.subscribe(\"changeActive\", (eventData) => {\n\tstatus = eventData.value; \n\tDatabase.readRecords(\"rodent\", \"Products\", function(eventData) {\n\t\tproductCollection = SensaCollection.load(eventData.value);\n\t\tupdateTable();\n\t});\n\tif (status !== \"Show Active\") {\n\t\t// Do not attempt to delete inactive elements\n\t\tScript.disableWidget(\"deleteMasterProdIcon\");\n\t\tScript.disableWidget(\"addMasterProdIcon\");\n\t} else {\n\t\t// Re-enable widgets if disabled before\n\t\tScript.enableWidget(\"deleteMasterProdIcon\");\n\t\tScript.enableWidget(\"addMasterProdIcon\");\n\t}\n});\n\nfunction editProduct(eventData) {\n\tScript.setState(\"productInfo\", eventData.value);\n\tScript.setState(\"modifyType\", \"edit_master\");\n\tClient.jumpToScreen(\"Edit Product\");\n}\n\nfunction updateTable() {\n\t//status = Script.getFormByKey(\"master\").activeSelection == \"Show Active\" ? '1' : '0';\n\tlet filteredComps = productCollection.query((record, pk) => {\n\t\tif (record['Status'] == (status == \"Show Active\")){\n\t\t\treturn true;\n\t\t}\n\t});\n\t\n\tClientEvents.publish(\"compDelRows\", \"\");\n\tvar tableComps = filteredComps.filter([\"Id\", \"Name\", \"Expiry\", \"WeightPerBlock\"]);\n\ttableComps.setColumns([\"Id\", \"Name\", \"Expiry\", \"Weight Per Block\"]);\n\tproductsTable.receiveValue(tableComps);\n}\n\nfunction createNewProduct(eventData) {\n\tScript.setState(\"modifyType\", \"add_master\");\n\tClient.jumpToScreen(\"Edit Product\");\n}\n\nfunction removeProductFromCompany() {\n\tvar formData = Script.getFormByKey(\"master\");\n\tvar ids = formData.products.getColumn(\"id\");\n\tfor (var i = 0; i < ids.length; i++) {\n\t\tproductsTable.deleteRows(ids[i]);\n\t\tlet req = {};\n\t\treq[{\"Id\": ids[i], \"Status\": \"0\"}] = {\"Id\": ids[i], \"Status\": \"0\"};\n\t\tDatabase.updateRecord(\"rodent\", \"Products\", req);\n\t}\n}"},"ev":{}},"masterProductsTable":{"t":"Table","lX":60,"lY":50,"sX":11.15,"sY":5.69,"s":"Manage Master Products","ps":{"enabled":"true","scalingType":"OK","width":"88.28%","height":"78.37%","x":"60px","y":"50px"},"ver":"190104c210519","dis":false,"tt":"","a":{"columns":"name,expiry,weight per block","text color":"#000000","row color":"#000000","selectable":"multi + single","form id":"master","form key":"products","title":"All Products","display header":"true","colWidths":"0.31716082659478884,0.3198562443845463,0.31805929919137466"},"ev":{"clientEvents":{"inputEvents":{"New Event #1":{"channel":"compDelRows/delete all rows","event":"delete all rows","important":"false"}},"outputEvents":{"Selected Product":{"channel":"productSelected/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"Dropdown#0":{"t":"Dropdown","lX":867,"lY":36,"sX":2.8,"sY":1,"s":"Manage Master Products","ps":{"enabled":"true","scalingType":"NOVERT","width":"22.17%","height":"7.3%","x":"71.44%","y":"4.95%"},"ver":"190104c210519","z":"130","dis":false,"tt":"","a":{"default options":"Show Active, Show Inactive","default value":"Show Active"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"changeActive/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"deleteMasterProdIcon":{"t":"Icon","lX":55,"lY":660,"sX":1.3,"sY":1.3,"s":"Manage Master Products","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"5.15%","height":"8.95%","x":"4.4%","y":"90.91%"},"ver":"200628c210519","dis":false,"tt":"","a":{"icon file":"trash","outline color":"no outline","hover":"red"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"removeMasterProducts/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"addMasterProdIcon":{"t":"Icon","lX":116,"lY":660,"sX":1.3,"sY":1.3,"s":"Manage Master Products","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"5.15%","height":"8.95%","x":"9.26%","y":"90.91%"},"ver":"200628c210519","dis":false,"tt":"","a":{"outline color":"no outline","icon file":"plus-square"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"addNewMasterProduct/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"userRolesTable":{"t":"Table","lX":47,"lY":118,"sX":8.75,"sY":4.53,"s":"User Roles","ps":{"enabled":"true","scalingType":"OK","width":"69.26%","height":"62.4%","x":"3.69%","y":"16.22%"},"ver":"190104c210519","dis":false,"tt":"","a":{"form id":"roles","form key":"users","display header":"true","text color":"#000000","row color":"#000000","columns":"user,updated by,updated on,is admin,is primary","title":"User Roles","selectable":"multi + single","colWidths":"0.18807339449541285,0.18807339449541285,0.19036697247706422,0.18807339449541285,0.18807339449541285"},"ev":{"clientEvents":{"inputEvents":{"New Event #1":{"channel":"usrDelRows/delete all rows","event":"delete all rows","important":"false"}},"outputEvents":{"New Event #2":{"channel":"userEdit/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"Scripting#10":{"t":"Scripting","lX":940,"lY":65,"sX":1,"sY":1,"s":"User Roles","ps":{"enabled":"false","scalingType":"OK","width":"9.07%","height":"8.26%","x":"77.06%","y":"4.95%"},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\n var userRolesCollection;\n var currentCompany;\n \n const userRolesTable = Script.getWidget(\"userRolesTable\");\n const compDropdown = Script.getWidget(\"usersCompanyDropdown\");\n \n Script.on('load', function() {\n     Database.readRecords(\"rodent\", \"Companies\", function(eventData) {\n         let companyCollection = SensaCollection.load(eventData.value);\n  \n          Database.readRecords(\"rodent\", \"UserRoles\", function(eventData) {\n              userRolesCollection = SensaCollection.load(eventData.value);\n              let filteredUsers = userRolesCollection.query((record, pk) => {\n                  if (record['User'] == Client.getUser()) {\n                      return true;\n                  }\n              });\n              var userCompanies = filteredUsers.getColumn(\"CompanyId\");\n  \n              let filteredCompanies = companyCollection.query((record, pk) => {\n                  if (userCompanies.includes(pk)) {\n                      return true;\n                  }\n              });\n  \n              let compNames = filteredCompanies.getColumn(\"Name\");\n              let compLoc = filteredCompanies.getColumn(\"Address\");\n              let compIds = filteredCompanies.getColumn(\"Id\");\n  \n              currentCompany = Script.getState(\"currentCompany\");\n              if (currentCompany == null) {\n                  currentCompany = compIds[0];\n              }\n  \n              let compObj = {};\n              compIds.map((comp, idx) => {\n                  compObj[comp] = compNames[idx] + \", \" + compLoc[idx];\n              });\n  \n              Object.keys(compObj).forEach((comp, idx) => {\n                  filteredCompanies.set({\"Id\": comp, \"Name\": compObj[comp]});\n              });\n  \n              filteredCompanies.renameColumn(\"Name\", \"text\");\n              filteredCompanies.renameColumn(\"Id\", \"value\");\n  \n              compDropdown.receiveTextValues(filteredCompanies);\n              compDropdown.receiveValue(compObj[currentCompany]);\n             \n              updateTable();\n          });\n     });\n });\n \n ClientEvents.subscribe(\"usrCcompSelected\", changeCompany);\n ClientEvents.subscribe(\"userEdit\", editUser);\n ClientEvents.subscribe(\"newUser\", createNewUser);\n ClientEvents.subscribe(\"deleteUsers\", deleteUsers);\n \n async function changeCompany(selected) {\n      currentCompany = selected.value;\n\n\t Database.readRecords(\"rodent\", \"UserRoles\", function(eventData) {\n          userRolesCollection = SensaCollection.load(eventData.value);\n          updateTable();\n      });\n }\n         \n function updateTable() {\n      let filteredUsers = userRolesCollection.query((record, pk) => {\n          if ((record['CompanyId'] == currentCompany) &&\n              (record['Status'] == '1')){\n              return true;\n          }\n      });\n\t \n\t var tableCollection = filteredUsers.filter([\"Id\", \"User\", \"UpdatedOn\", \"UpdatedBy\", \"IsAdmin\", \"IsPrimary\"]);\n\t tableCollection.setColumns([\"Id\", \"User\", \"Updated On\", \"Updated By\", \"Is Admin\", \"Is Primary\"]);\n  \n      ClientEvents.publish(\"usrDelRows\", \"\");\n      userRolesTable.receiveValue(tableCollection);\n }\n \n function editUser(eventData) {\n     Script.setState(\"userRoleInfo\", eventData.value);\n     Script.setState(\"companyId\", currentCompany);\n     Script.setState(\"modifyType\", \"edit\");\n     Client.jumpToScreen(\"Edit User Role\");\n }\n \n function createNewUser() {\n     Script.setState(\"companyId\", currentCompany);\n     Script.setState(\"modifyType\", \"add\");\n     Client.jumpToScreen(\"Edit User Role\");\n }\n \n function deleteUsers() {\n     let formData = Script.getFormByKey(\"roles\");\n     var ids = formData.users.getColumn(\"id\");\n     for (var i = 0; i < ids.length; i++) {\n          userRolesTable.deleteRows(ids[i]);\n          Database.deleteRecord(\"rodent\", \"UserRoles\", \"Id\", ids[i]);\n      }\n }","file name":"../../js/settings/manage user roles/manageUserRoles.js"},"ev":{}},"usersCompanyDropdown":{"t":"Dropdown","lX":693,"lY":105,"sX":2.25,"sY":1,"s":"User Roles","ps":{"enabled":"true","scalingType":"NOVERT","width":"17.85%","height":"7.3%","x":"54.86%","y":"14%"},"ver":"190104c210519","dis":false,"tt":"","a":{"default options":""},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"usrCcompSelected/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"Icon#1":{"t":"Icon","lX":47,"lY":584,"sX":1.14,"sY":1.14,"s":"User Roles","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"4.53%","height":"7.85%","x":"3.71%","y":"80.46%"},"ver":"200628c210519","dis":false,"tt":"","a":{"icon file":"trash","outline color":"no outline","hover":"red"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"deleteUsers/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"Scripting#7":{"t":"Scripting","lX":420,"lY":25,"sX":1,"sY":1,"s":"Edit User Role","ps":{"enabled":"false","scalingType":"OK","width":"9.07%","height":"8.26%","x":"38.08%","y":"2.06%"},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\nvar userId;\nvar modifyType;\nvar companyId;\nvar userData;\n\nconst userFormContainer = Script.getWidget(\"userRoleContainer\");\nconst userSubmitButton = Script.getWidget(\"userRoleSubmit\");\nconst editUserSelect = Script.getWidget(\"editUserSelect\");\nconst editUserCompSelect = Script.getWidget(\"editUserCompSelect\");\nconst editUserIsAdmin = Script.getWidget(\"editUserIsAdmin\");\n\nconst cancelRoleButton = Script.getWidget(\"cancelRoleButton\");\n\nScript.on('load', function() {\n\tmodifyType = Script.getState(\"modifyType\");\n\tcancelRoleButton.subscribe(\"pressed\", ()=> {\n\t\tClient.jumpToScreen(\"User Roles\");\n\t});\n\tif (modifyType == \"add\") {\n        userFormContainer.setTitle(\"New User Role\");\n\t\t//Script.enableWidget(\"editUserSelect\");\n\t\tDatabase.readRecords(\"Directory\", \"users\", function(eventData) {\n\t\t\tlet userCollection = SensaCollection.load(eventData.value);\n\t\t\teditUserSelect.receiveList(userCollection.getColumn(\"username\"));\n\t\t});\n    } else if (modifyType == \"edit\") {\n        userData = Script.getState(\"userRoleInfo\");\n\t\teditUserIsAdmin.receiveValue(userData.getColumn(\"isadmin\")[0]);\n\t\tuserFormContainer.setTitle(\"Edit User Role\");\n    }\n\t\n\tDatabase.readRecords(\"rodent\", \"Companies\", function(eventData) {\n\t\tlet companyCollection = SensaCollection.load(eventData.value);\n\t\tDatabase.readRecords(\"rodent\", \"UserRoles\", function(eventData) {\n\t\t\t let userCollection = SensaCollection.load(eventData.value);\n\t\t\t let filteredUsers = userCollection.query((record, pk) => {\n\t\t\t\t if (record['User'] == Client.getUser()) {\n\t\t\t\t\t return true;\n\t\t\t\t }\n\t\t\t });\n\t\t\t var userCompanies = filteredUsers.getColumn(\"CompanyId\");\n \n\t\t\t let filteredCompanies = companyCollection.query((record, pk) => {\n\t\t\t\t if (userCompanies.includes(pk)) {\n\t\t\t\t\t return true;\n\t\t\t\t }\n\t\t\t });\n \n\t\t\t let compNames = filteredCompanies.getColumn(\"Name\");\n\t\t\t let compLoc = filteredCompanies.getColumn(\"Address\");\n\t\t\t let compIds = filteredCompanies.getColumn(\"Id\");\n \n\t\t\t companyId = Script.getState(\"companyId\");\n\t\t\t if (companyId == null) {\n\t\t\t\t companyId = compIds[0];\n\t\t\t }\n \n\t\t\t let compObj = {};\n\t\t\t compIds.map((comp, idx) => {\n\t\t\t\t compObj[comp] = compNames[idx] + \", \" + compLoc[idx];\n\t\t\t });\n \n\t\t\t Object.keys(compObj).forEach((comp, idx) => {\n\t\t\t\t filteredCompanies.set({\"Id\": comp, \"Name\": compObj[comp]});\n\t\t\t });\n \n\t\t\t filteredCompanies.renameColumn(\"Name\", \"text\");\n\t\t\t filteredCompanies.renameColumn(\"Id\", \"value\");\n \n\t\t\t editUserCompSelect.receiveTextValues(filteredCompanies);\n\t\t\t editUserCompSelect.receiveValue(filteredCompanies.get(companyId).text);\n\t\t\tif (userData != undefined) {\n\t\t\t\teditUserSelect.receiveValue(userData.getColumn(\"user\")[0]);\n\t\t\t\t//Script.disableWidget(\"editUserSelect\");\n\t\t\t\tuserId = userData.getColumn(\"id\")[0];\n\t\t\t}\n\t\t });\n\t});\n});\n\nClientEvents.subscribe(\"finishEditUser\", function() {\n\tswitch (modifyType) {\n\t\tcase 'edit':\n\t\t\thandleEdit();\n\t\t\tbreak;\n\t\tcase 'add':\n\t\t\thandleCreate();\n\t\t\tbreak;\n\t}\n});\n\nfunction handleEdit() {\n\tvar formObj = Script.getFormByKey(\"editUser\");\n\tif (formObj == undefined) {\n\t\talert(\"Please fill out all required fields\");\n\t\treturn;\n\t}\n\tvar dbReq = {};\n\tformObj.Id = userId;\n\tlet today = new Date();\n\ttoday = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n\tformObj.UpdatedOn = today;\n\tformObj.UpdatedBy = Client.getUser();\n\tformObj.IsAdmin = +formObj.IsAdmin;\n\tformObj.IsPrimary = +formObj.IsPrimary;\n\tdbReq[userId] = formObj;\n\t\n\tDatabase.updateRecord(\"rodent\", \"UserRoles\", dbReq, () => {\n\t\tScript.setState(\"currentCompany\", formObj.CompanyId);\n\t\t// Update the other records with this user to account for the IsAdmin field\n\t\tDatabase.readRecords(\"rodent\", \"UserRoles\", function (eventData) {\n\t\t\teventData.value.forEach((record, pk) => {\n\t\t\t\tif (record.Id != userId) {\n\t\t\t\t\tlet newReq = {};\n\t\t\t\t\trecord.IsAdmin = +formObj.IsAdmin;\n\t\t\t\t\tnewReq[userId] = record;\n\t\t\t\t\tDatabase.updateRecord(\"rodent\", \"UserRoles\", newReq);\n\t\t\t\t}\n\t\t\t});\n\t\t\tClient.jumpToScreen(\"User Roles\");\n\t\t}, {filter: \n\t\t\t`User='${userData.getColumn(\"user\")[0]}'`\n\t\t   }\n\t    );\n    });\n}\n\nfunction handleCreate() {\n\tDatabase.readRecords(\"rodent\", \"UserRoles\", function(eventData) {\n\t\tlet userRoleCollection = SensaCollection.load(eventData.value);\n\t\tvar formObj = Script.getFormByKey(\"editUser\");\n\t\tif (formObj == undefined) {\n\t\t\talert(\"Please fill out all required fields\");\n\t\t\treturn;\n\t\t}\n\t\tvar dbReq = {};\n\t\t\n\t\tlet today = new Date();\n\t\ttoday = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n\t\tlet id = +userRoleCollection.getColumn(\"Id\").at(-1) + 1;\n\t\tformObj.Id = `${id}`;\n\t\tformObj.CreatedOn = today;\n\t\tformObj.UpdatedOn = today;\n\t\tformObj.Owner = Client.getUser();\n\t\tformObj.CreatedBy = Client.getUser();\n        formObj.UpdatedBy = Client.getUser();\n\t\tformObj.IsAdmin = +formObj.IsAdmin;\n\t\tconsole.log(\"data before \" + formObj.IsPrimary);\n\t\tformObj.IsPrimary = +formObj.IsPrimary;\n\t\n\t\tconsole.log(\"data after \" + formObj.IsPrimary);\n\t\t\n\t\tdbReq[id] = formObj;\n\t\tDatabase.createRecords(\"rodent\", \"UserRoles\", dbReq, () => {\n             Script.setState(\"currentCompany\", formObj.CompanyId);\n\t\t\t Database.readRecords(\"rodent\", \"UserRoles\", function (eventData) {\n\t\t\t\teventData.value.forEach((record, pk) => {\n\t\t\t\t\tif (record.Id != userId) {\n\t\t\t\t\t\tlet newReq = {};\n\t\t\t\t\t\trecord.IsAdmin = +formObj.IsAdmin;\n\t\t\t\t\t\tnewReq[userId] = record;\n\t\t\t\t\t\tDatabase.updateRecord(\"rodent\", \"UserRoles\", newReq);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tClient.jumpToScreen(\"User Roles\");\n\t\t\t}, {filter: \n\t\t\t\t`User='${formObj.User}'`\n\t\t\t   }\n\t\t\t);\n         });\n\t});\n}"},"ev":{}},"userRoleContainer":{"t":"Container","lX":25,"lY":146,"sX":6.25,"sY":2.94,"s":"Edit User Role","ps":{"enabled":"true","scalingType":"OK","width":"49.49%","height":"40.5%","x":"1.99%","y":"20.06%"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"color":"grey","title":"Title"},"ev":{}},"userRoleSubmit":{"t":"Button","lX":519,"lY":348,"sX":1,"sY":1,"s":"Edit User Role","ps":{"enabled":"true","scalingType":"OK","width":"7.92%","height":"6.34%","x":"41.09%","y":"47.93%"},"ver":"190104c210519","dis":false,"tt":"","a":{"color":"orange strong","button name":"Save"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"finishEditUser/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"editUserCompSelect":{"t":"Dropdown","lX":40,"lY":272,"sX":5.85,"sY":1,"s":"Edit User Role","ps":{"enabled":"true","scalingType":"NOVERT","width":"46.32%","height":"7.3%","x":"3.17%","y":"37.52%"},"ver":"190104c210519","dis":false,"tt":"","a":{"label text":"Company","form id":"editUser","form key":"CompanyId","default options":""},"ev":{}},"editUserSelect":{"t":"Dropdown","lX":40,"lY":200,"sX":5.9,"sY":1,"s":"Edit User Role","ps":{"enabled":"true","scalingType":"NOVERT","width":"46.71%","height":"7.3%","x":"3.17%","y":"27.52%"},"ver":"190104c210519","dis":false,"tt":"","a":{"label text":"User","form id":"editUser","form key":"User","default options":""},"ev":{}},"Icon#2":{"t":"Icon","lX":110,"lY":584,"sX":1.14,"sY":1.14,"s":"User Roles","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"4.53%","height":"7.85%","x":"8.71%","y":"80.46%"},"ver":"200628c210519","dis":false,"tt":"","a":{"icon file":"person-plus","outline color":"no outline"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"newUser/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"Dropdown#1":{"t":"Dropdown","lX":1365,"lY":120,"sX":2,"sY":1,"s":"Error Codes","ps":{"enabled":"false","scalingType":"NOVERT","width":"200px","height":"4.19%","x":"57.28%","y":"9.64%"},"ver":"190104c210519","z":"140","dis":false,"tt":"","a":{"default value":"Show Active","default options":"Show Active, Show Inactive"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"changeActiveError/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"Scripting#0":{"t":"Scripting","lX":585,"lY":610,"sX":1,"sY":1,"s":"Error Codes","ps":{"enabled":"false","scalingType":"OK","width":"9.07%","height":"8.26%","x":"1.36%","y":"62.76%"},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\nconst errorCodesTable = Script.getWidget(\"errorCodesTable\");\nconst troubleTable = Script.getWidget(\"troubleTable\");\nconst deviceModelDropdown = Script.getWidget(\"deviceModelDropdown\");\nconst errorColumns = [\"Id\", \"Code Id\", \"Description\", \"Troubleshooting Help\", \"Code Type\", \"CreatedBy\", \"UpdatedBy\", \"CreatedOn\", \"UpdatedOn\", \"Out of bounds\", \"Status\", \"Model Id\"];\nconst fileColumns = [\"Id\", \"File Location\", \"CreatedBy\", \"UpdatedBy\", \"CreatedAt\", \"Status\"];\n\nvar errorCollection;\nvar troubleFilesCollection;\n\nvar status = \"Show Active\";\nvar deviceModel;\nvar deviceModelMap = {};\n\nconst deleteCodes = {\n    \"errorCodesTable\": \"compDelErrorRows\",\n    \"troubleTable\": \"compDelFileRows\"\n}\n\nClientEvents.subscribe(\"errorCodeSelected\", editErrorCode);\nClientEvents.subscribe(\"addErrorCode\", createNewErrorCode);\nClientEvents.subscribe(\"troubleFileSelected\", editTroubleFile);\nClientEvents.subscribe(\"addTroubleFile\", createNewTroubleFile);\nClientEvents.subscribe(\"deleteErrorCodes\", removeErrorCode);\nClientEvents.subscribe(\"deleteTroubleFiles\", removeTroubleFiles);\nClientEvents.subscribe(\"deviceModelSelected\", setDeviceModel);\n\t\t\t\t\t   \nClientEvents.subscribe(\"changeActiveError\", (eventData) => {\n    status = eventData.value; \n    Database.readRecords(\"rodent\", \"ErrorCodes\", function(eventData) {\n        errorCollection = SensaCollection.load(eventData.value);\n        errorCollection.setColumns(errorColumns);\n        updateTable(errorCodesTable, errorCollection);\n    });\n    if (status !== \"Show Active\") {\n        // Do not attempt to delete inactive elements\n        Script.hideWidget(\"deleteErrorCodeIcon\");\n    } else {\n        // Re-enable widgets if hidden before\n        Script.showWidget(\"deleteErrorCodeIcon\");\n    }\n});\n\nClientEvents.subscribe(\"changeActiveFiles\", (eventData) => {\n    status = eventData.value; \n    Database.readRecords(\"rodent\", \"TroubleshootingFiles\", function(eventData) {\n        troubleFilesCollection = SensaCollection.load(eventData.value);\n        troubleFilesCollection.setColumns(fileColumns);\n        updateTable(troubleTable, troubleFilesCollection);\n    });\n    if (status !== \"Show Active\") {\n        // Do not attempt to delete inactive elements\n        Script.hideWidget(\"deleteTroubleFilesIcon\");\n    } else {\n        // Re-enable widgets if hidden before\n        Script.showWidget(\"deleteTroubleFilesIcon\");\n    }\n});\n\nScript.on('load', function() {\n\n    Database.readRecords(\"rodent\", \"ErrorCodes\", function(eventData) {\n        errorCollection = SensaCollection.load(eventData.value);\n        errorCollection.setColumns(errorColumns);\n\t\tDatabase.readRecords(\"rodent\", \"Model\", function (eventData) {\n\t\t\tlet modelIds = eventData.value.getColumn(\"Id\");\n\t\t\tlet modelNames = eventData.value.getColumn(\"Name\");\n\t\t\tmodelNames.forEach((key, i) => deviceModelMap[key] = modelIds[i]);\n\t\t\t\n\t\t\tdeviceModelDropdown.receiveList(modelNames);\n\t\t\tdeviceModel = modelIds[0];\n\t\t\tScript.setState(\"errorDeviceModel\", deviceModel);\n\t\t\tupdateTable(errorCodesTable, errorCollection);\n\t\t});\n    });\n\n    Database.readRecords(\"rodent\", \"TroubleshootingFiles\", function(eventData) {\n        troubleFilesCollection = SensaCollection.load(eventData.value);\n        troubleFilesCollection.setColumns(fileColumns)\n        updateTable(troubleTable, troubleFilesCollection);\n    });\n\n});\n\nfunction setDeviceModel(eventData) {\n\tdeviceModel = deviceModelMap[eventData.value];\n\tupdateTable(errorCodesTable, errorCollection);\n\tScript.setState(\"errorDeviceModel\", deviceModel); \n}\n\nfunction updateTable(table, collection) {\n    let filteredCollection = collection.query((record, pk) => {\n\t\tif (record[\"ModelId\"] == undefined) {\n\t\t\t// Troubleshooting file\n\t\t\tif (record['Status'] == (status == \"Show Active\")){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} else {\n\t\t\t// Error Code\n\t\t\tif (record['Status'] == (status == \"Show Active\") && record[\"ModelId\"] == deviceModel){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n    });\n    \n    ClientEvents.publish(deleteCodes[table._name], \"\");\n    table.receiveValue(filteredCollection);\n}\n\nfunction editErrorCode(eventData) {\n    Script.setState(\"errorData\", eventData.value);\n    Script.setState(\"modifyType\", \"edit\");\n    Client.jumpToScreen(\"Edit Error Codes\");\n}\n\nfunction editTroubleFile(eventData) {\n    Script.setState(\"fileData\", eventData.value);\n    Script.setState(\"modifyType\", \"edit_file\");\n    Client.jumpToScreen(\"Edit Error Codes\");\n}\n\nfunction createNewErrorCode() {\n    Script.setState(\"modifyType\", \"add\");\n    Client.jumpToScreen(\"Edit Error Codes\");\n}\n\nfunction createNewTroubleFile() {\n    Script.setState(\"modifyType\", \"add_file\");\n    Client.jumpToScreen(\"Edit Error Codes\");\n}\n\nfunction removeErrorCode() {\n    var formData = Script.getFormByKey(\"errors\");\n    var ids = formData.codes.getColumn(\"id\");\n    for (var i = 0; i < ids.length; i++) {\n        errorCodesTable.deleteRows(ids[i]);\n        let req = {};\n        req[{\"Id\": ids[i], \"Status\": \"0\"}] = {\"Id\": ids[i], \"Status\": \"0\"};\n        Database.updateRecord(\"rodent\", \"ErrorCodes\", req);\n    }\n}\n\nfunction removeTroubleFiles() {\n    var formData = Script.getFormByKey(\"errors\");\n    var ids = formData.files.getColumn(\"id\");\n    for (var i = 0; i < ids.length; i++) {\n        troubleTable.deleteRows(ids[i]);\n        let req = {};\n        req[{\"Id\": ids[i], \"Status\": \"0\"}] = {\"Id\": ids[i], \"Status\": \"0\"};\n        Database.updateRecord(\"rodent\", \"TroubleshootingFiles\", req);\n    }\n}"},"ev":{}},"errorCodesTable":{"t":"Table","lX":24,"lY":114,"sX":11.37,"sY":4.41,"s":"Error Codes","ps":{"enabled":"true","scalingType":"OK","width":"90%","height":"60.74%","x":"1.91%","y":"16%"},"ver":"190104c210519","dis":false,"tt":"","a":{"text color":"#000000","row color":"#000000","columns":"code id,description,troubleshooting help,code type,out of bounds","display header":"true","selectable":"multi + single","title":"Error Codes","form id":"errors","form key":"codes","colWidths":"0.18967229394240318,0.18669314796425024,0.19463753723932473,0.1906653426017875,0.18867924528301888"},"ev":{"clientEvents":{"inputEvents":{"Delete All Rows":{"channel":"compDelErrorRows/delete all rows","event":"delete all rows","important":"false"}},"outputEvents":{"Selected Error code":{"channel":"errorCodeSelected/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"troubleTable":{"t":"Table","lX":1615,"lY":135,"sX":6.16,"sY":4.5,"s":"Error Codes","ps":{"enabled":"false","scalingType":"OK","width":"25.85%","height":"35.55%","x":"67.86%","y":"11.3%"},"ver":"190104c210519","dis":false,"tt":"","a":{"text color":"#000000","row color":"#000000","columns":"file location","display header":"true","colWidths":"0.9185667752442996","selectable":"multi + single","title":"Troubleshooting Files","form id":"errors","form key":"files","auto scroll":"false"},"ev":{"clientEvents":{"inputEvents":{"Delete All Rows":{"channel":"compDelFileRows/delete all rows","event":"delete all rows","important":"false"}},"outputEvents":{"Edit Row":{"channel":"troubleFileSelected/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"deleteErrorCodeIcon":{"t":"Icon","lX":27,"lY":572,"sX":0.84,"sY":0.84,"s":"Error Codes","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"3.31%","height":"5.79%","x":"2.13%","y":"80.47%"},"ver":"200628c210519","dis":false,"tt":"","a":{"outline color":"no outline","icon file":"trash","hover":"red"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"deleteErrorCodes/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"addErrorCodeIcon":{"t":"Icon","lX":70,"lY":572,"sX":0.84,"sY":0.84,"s":"Error Codes","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"3.31%","height":"3.72%","x":"5.52%","y":"80.47%"},"ver":"200628c210519","dis":false,"tt":"","a":{"icon file":"plus-square","outline color":"no outline"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"addErrorCode/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"deleteTroubleFilesIcon":{"t":"Icon","lX":1620,"lY":600,"sX":1,"sY":1,"s":"Error Codes","ps":{"enabled":"false","scalingType":"NOHORIZ,NOVERT","width":"50px","height":"3.95%","x":"72.62%","y":"49.13%"},"ver":"200628c210519","dis":false,"tt":"","a":{"outline color":"no outline","icon file":"trash","hover":"red"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"deleteTroubleFiles/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"addTroubleFilesIcon":{"t":"Icon","lX":1675,"lY":600,"sX":0.9,"sY":0.9,"s":"Error Codes","ps":{"enabled":"false","scalingType":"NOHORIZ,NOVERT","width":"50px","height":"3.55%","x":"70.25%","y":"47.39%"},"ver":"200628c210519","dis":false,"tt":"","a":{"icon file":"plus-square","outline color":"no outline"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"addTroubleFile/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"Scripting#1":{"t":"Scripting","lX":660,"lY":315,"sX":1,"sY":1,"s":"Edit Error Codes","ps":{"enabled":"false","scalingType":"OK","width":"4.2%","height":"7.9%","x":"27.74%","y":"25.04%"},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\nvar errorId;\nvar fileId;\nvar modifyType;\nvar deviceModelMap = {};\nconst errorContainer = Script.getWidget(\"errorContainer\");\nconst errorSubmitButton = Script.getWidget(\"errorSubmitButton\");\nconst troubleshootinghelp = Script.getWidget(\"troubleshootinghelp\");\nconst errorModelDropdown = Script.getWidget(\"errorModelDropdown\");\nconst cancelErrorCode = Script.getWidget(\"cancelErrorCode\");\nScript.on('load', function() {\n    // hide at start\n    hideErrorForm();\n    hideFileForm();\n\n\tcancelErrorCode.subscribe(\"pressed\", ()=> {\n\t\tClient.jumpToScreen(\"Error Codes\");\n\t});\n\t\n    modifyType = Script.getState(\"modifyType\");\n    if (modifyType == \"add_file\") {\n        errorContainer.setTitle(\"New Troubleshooting File\");\n        showFileForm();\n        return;\n    } else if (modifyType == \"edit_file\") {\n        var fileData = Script.getState(\"fileData\");\n        errorContainer.setTitle(\"Edit Troubleshooting File\");\n\n        var fileObj = {};\n        fileId = fileData.getColumn(\"id\")[0];\n        fileObj.FileLocation = fileData.getColumn(\"file location\");\n        fileObj.Status = fileData.getColumn(\"status\");\n        Script.setForm(\"filelocation\", fileObj);\n        showFileForm();\n        return;\n    }\n\n    showErrorForm();\n    Database.readRecords(\"rodent\", \"TroubleshootingFiles\", function(eventData) {\n        let fileCollection = SensaCollection.load(eventData.value);\n        fileCollection = fileCollection.filter([\"Id\", \"FileLocation\"]);\n        fileCollection.setColumns([\"value\", \"text\"])\n        troubleshootinghelp.receiveTextValues(fileCollection);\n\t\t\n\t\tDatabase.readRecords(\"rodent\", \"Model\", function (eventData) {\n\t\t\tvar errorData;\n \n\t\t\tlet modelIds = eventData.value.getColumn(\"Id\");\n\t\t\tlet modelNames = eventData.value.getColumn(\"Name\");\n\t\t\tlet errorModels = eventData.value;\n\t\t\tmodelIds.forEach((key, i) => deviceModelMap[key] = modelNames[i]);\n\t\t\t\n\t\t\terrorModels.filter([\"Id\", \"Name\"]);\n\t\t\terrorModels.renameColumn(\"Name\", \"text\");\n\t\t\terrorModels.renameColumn(\"Id\", \"value\");\n\t\t\terrorModelDropdown.receiveTextValues(errorModels);\n\t\t\t\n\t\t\tif (modifyType == \"add\") {\n\t\t\t\terrorContainer.setTitle(\"New Error Code\");\n\t\t\t\treturn;\n\t\t\t} else if (modifyType == \"edit\") {\n\t\t\t\terrorData = Script.getState(\"errorData\");\n\t\t\t}\n\t\t\t\n\t\t\tvar errorObj = {}\n\t\t\terrorId = errorData.getColumn(\"id\")[0];\n\t\t\terrorObj.CodeId = errorData.getColumn(\"code id\");\n\t\t\terrorObj.Description = errorData.getColumn(\"description\");\n\t\t\terrorObj.Status = errorData.getColumn(\"status\");\n\t\t\tlet filteredFile = fileCollection.query((record, pk) => {\n\t\t\t\tif (record.value == errorData.getColumn(\"troubleshooting help\")[0]) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t\t\terrorObj.TroubleshootingHelp = filteredFile.data[0];\n\t\t\terrorObj.CodeType = errorData.getColumn(\"code type\");\n\t\t\terrorObj.OOB = errorData.getColumn(\"out of bounds\");\n\t\t\t//errorObj.ModelId = errorData.getColumn(\"model id\")[0];\n\t\t\tScript.setForm(\"errorcode\", errorObj);\n\t\t\terrorModelDropdown.receiveValue(deviceModelMap[errorData.getColumn(\"model id\")[0]]);\n\t\t\terrorContainer.setTitle(\"Edit Error Code\");\n\t\t});\n    });\n});\n  \nClientEvents.subscribe(\"finishSubmitError\", function() {\n\tdebugger;\n    switch (modifyType) {\n        case 'edit':\n            handleEdit();\n            break;\n        case 'add':\n            handleCreate();\n            break;\n        case 'edit_file':\n            handleEditFile();\n            break;\n        case 'add_file':\n            handleCreateFile();\n            break;\n    }\n});\n  \nfunction handleEdit() {\n    var formObj = Script.getFormByKey(\"errorcode\");\n    if (formObj == undefined) {\n        alert(\"Please fill out all required fields\");\n        return;\n    }\n        \n    var dbReq = {};\n    formObj.Id = errorId;\n    formObj.Status = +formObj.Status;\n    let today = new Date();\n    today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n    formObj.UpdatedOn = today;\n    formObj.UpdatedBy = Client.getUser();\n    dbReq[errorId] = formObj;\n        \n    Database.updateRecord(\"rodent\", \"ErrorCodes\", dbReq, () => {\n        //Script.setState(\"currentCompany\", formObj.CompanyId);\n        Client.jumpToScreen(\"Error Codes\");\n    });\n}\n\nfunction handleEditFile() {\n    var formObj = Script.getFormByKey(\"filelocation\");\n    if (formObj == undefined) {\n        alert(\"Please fill out all required fields\");\n        return;\n    }\n    var dbReq = {};\n    formObj.Id = fileId;\n    formObj.Status = +formObj.Status;\n    formObj.UpdatedBy = Client.getUser();\n    dbReq[fileId] = formObj;\n        \n    Database.updateRecord(\"rodent\", \"TroubleshootingFiles\", dbReq, () => {\n        //Script.setState(\"currentCompany\", formObj.CompanyId);\n        Client.jumpToScreen(\"Error Codes\");\n    });\n}\n \n  \nfunction handleCreate() {\n    Database.readRecords(\"rodent\", \"ErrorCodes\", function(eventData) {\n        var errorCollection = SensaCollection.load(eventData.value);\n        var formObj = Script.getFormByKey(\"errorcode\");\n        \n        if (formObj == undefined) {\n            alert(\"Please fill out all required fields\");\n            return;\n        }\n\n        var dbReq = {};\n        var errorCount = Object.keys(errorCollection.data).length;\n        formObj.Id = `${errorCount + 1}`;\n        formObj.Status = +formObj.Status;\n\n        let today = new Date();\n        today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n        formObj.CreatedOn = today;\n        formObj.UpdatedOn = today;\n        formObj.CreatedBy = Client.getUser();\n        formObj.UpdatedBy = Client.getUser();\n        dbReq[errorCount + 1] = formObj;\n\n        Database.createRecords(\"rodent\", \"ErrorCodes\", dbReq, () => {\n            \n            Client.jumpToScreen(\"Error Codes\");\n        });\n    });\n}\n\nfunction handleCreateFile() {\n    Database.readRecords(\"rodent\", \"TroubleshootingFiles\", function(eventData) {\n        var fileCollection = SensaCollection.load(eventData.value);\n        var formObj = Script.getFormByKey(\"filelocation\");\n        \n        if (formObj == undefined) {\n            alert(\"Please fill out all required fields\");\n            return;\n        }\n\n        var dbReq = {};\n        var fileCount = Object.keys(fileCollection.data).length;\n        formObj.Id = `${fileCount + 1}`;\n        formObj.Status = +formObj.Status;\n\n        let today = new Date();\n        today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n        formObj.CreatedAt = today;\n        formObj.CreatedBy = Client.getUser();\n        formObj.UpdatedBy = Client.getUser();\n        dbReq[fileCount + 1] = formObj;\n\n        Database.createRecords(\"rodent\", \"TroubleshootingFiles\", dbReq, () => {\n            \n            Client.jumpToScreen(\"Error Codes\");\n        });\n    });\n}\n\nfunction hideErrorForm() {\n    Script.hideWidget(\"codeId\");\n    Script.hideWidget(\"desc\");\n    Script.hideWidget(\"troubleshootinghelp\");\n    Script.hideWidget(\"codetype\");\n    Script.hideWidget(\"oob\");\n\tScript.hideWidget(\"errorModelDropdown\");\n}\n\nfunction showErrorForm() {\n    Script.showWidget(\"codeId\");\n    Script.showWidget(\"desc\");\n    Script.showWidget(\"troubleshootinghelp\");\n    Script.showWidget(\"codetype\");\n    Script.showWidget(\"oob\");\n\tScript.showWidget(\"errorModelDropdown\");\n}\n\nfunction hideFileForm() {\n    Script.hideWidget(\"fileloc\");\n    Script.hideWidget(\"filestatus\");\n}\n\nfunction showFileForm() {\n    Script.showWidget(\"fileloc\");\n    Script.showWidget(\"filestatus\");\n}"},"ev":{}},"Input#3":{"t":"Input","lX":69,"lY":326,"sX":1.15,"sY":1,"s":"Edit Error Codes","ps":{"enabled":"true","scalingType":"NOVERT","width":"9.08%","height":"7.3%","x":"5.45%","y":"75.32%"},"ver":"270520c210519","dis":false,"tt":"","a":{"color":"grey","label text":"Status","type":"checkbox","checkbox label side":"right","default value":"1","form id":"errorcode","form key":"Status"},"ev":{}},"errorContainer":{"t":"Container","lX":57,"lY":30,"sX":4.93,"sY":5.86,"s":"Edit Error Codes","ps":{"enabled":"true","scalingType":"OK","width":"39.06%","height":"80.72%","x":"4.53%","y":"4.13%"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"color":"grey","title":"Title"},"ev":{}},"errorSubmitButton":{"t":"Button","lX":422,"lY":547,"sX":1.15,"sY":1,"s":"Edit Error Codes","ps":{"enabled":"true","scalingType":"OK","width":"9.07%","height":"6.34%","x":"33.39%","y":"75.32%"},"ver":"190104c210519","dis":false,"tt":"","a":{"color":"orange strong","button name":"Submit"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"finishSubmitError/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"troubleshootinghelp":{"t":"Dropdown","lX":72,"lY":352,"sX":4.64,"sY":1,"s":"Edit Error Codes","ps":{"enabled":"true","scalingType":"NOVERT","width":"36.74%","height":"7.3%","x":"5.7%","y":"48.45%"},"ver":"190104c210519","z":"110","dis":false,"tt":"","a":{"default options":"","form id":"errorcode","form key":"TroubleshootingHelp","label text":"Troubleshooting Help","disable edit":"false"},"ev":{}},"Dropdown#2":{"t":"Dropdown","lX":2050,"lY":130,"sX":1.8,"sY":1,"s":"Error Codes","ps":{"enabled":"false","scalingType":"NOVERT","width":"7.55%","height":"4.19%","x":"96% - 200px","y":"10.19%"},"ver":"190104c210519","dis":false,"tt":"","a":{"default value":"Show Active","default options":"Show Active, Show Inactive"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"changeActiveFiles/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"codeId":{"t":"Input","lX":72,"lY":176,"sX":4.77,"sY":1,"s":"Edit Error Codes","ps":{"enabled":"true","scalingType":"NOVERT","width":"37.74%","height":"7.3%","x":"5.7%","y":"22.24%"},"ver":"270520c210519","dis":false,"tt":"","a":{"color":"grey","form id":"errorcode","label text":"Code ID","form key":"CodeId","type":"number","required":"true"},"ev":{}},"desc":{"t":"Input","lX":81,"lY":290,"sX":4.77,"sY":1,"s":"Edit Error Codes","ps":{"enabled":"true","scalingType":"NOVERT","width":"37.74%","height":"7.3%","x":"5.7%","y":"40.01%"},"ver":"270520c210519","z":"110","dis":false,"tt":"","a":{"color":"grey","form id":"errorcode","label text":"Description","form key":"Description","required":"true"},"ev":{}},"codetype":{"t":"Input","lX":72,"lY":421,"sX":4.77,"sY":1,"s":"Edit Error Codes","ps":{"enabled":"true","scalingType":"NOVERT","width":"37.74%","height":"7.3%","x":"5.7%","y":"58.01%"},"ver":"270520c210519","dis":false,"tt":"","a":{"color":"grey","form id":"errorcode","label text":"Code Type","form key":"CodeType","type":"number","required":"true"},"ev":{}},"oob":{"t":"Input","lX":72,"lY":485,"sX":4.77,"sY":1,"s":"Edit Error Codes","ps":{"enabled":"true","scalingType":"NOVERT","width":"37.74%","height":"7.3%","x":"5.7%","y":"66.79%"},"ver":"270520c210519","dis":false,"tt":"","a":{"color":"grey","form id":"errorcode","label text":"Out of Bounds","form key":"OOB","type":"number","required":"true"},"ev":{}},"fileloc":{"t":"Input","lX":72,"lY":112,"sX":4.77,"sY":1,"s":"Edit Error Codes","ps":{"enabled":"true","scalingType":"NOVERT","width":"37.74%","height":"7.3%","x":"5.7%","y":"13.42%"},"ver":"270520c210519","dis":false,"tt":"","a":{"color":"grey","form id":"filelocation","label text":"File Location","form key":"FileLocation","required":"true"},"ev":{}},"filestatus":{"t":"Input","lX":155,"lY":547,"sX":0.85,"sY":1,"s":"Edit Error Codes","ps":{"enabled":"true","scalingType":"NOVERT","width":"6.73%","height":"7.3%","x":"14.27%","y":"75.32%"},"ver":"270520c210519","dis":false,"tt":"","a":{"color":"grey","label text":"Status","type":"checkbox","checkbox label side":"right","default value":"1","form key":"Status","form id":"filelocation"},"ev":{}},"Dropdown#3":{"t":"Dropdown","lX":830,"lY":58,"sX":3.7,"sY":1,"s":"Manage Companies","ps":{"enabled":"true","scalingType":"NOVERT","width":"29.3%","height":"7.3%","x":"66.51%","y":"8.5%"},"ver":"190104c210519","z":"140","dis":false,"tt":"","a":{"default options":"Show Active, Show Inactive","default value":"Show Active"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"changeActiveCompany/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"Scripting#2":{"t":"Scripting","lX":50,"lY":900,"sX":1,"sY":1,"s":"Manage Companies","ps":{"enabled":"false","scalingType":"OK","width":"","height":"","x":"","y":""},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\nconst companiesTable = Script.getWidget(\"companiesTable\");\n \nvar companiesCollection;\n \nvar status = \"Show Active\";\n \nClientEvents.subscribe(\"editCompany\", editCompany);\nClientEvents.subscribe(\"addCompany\", addCompany);\nClientEvents.subscribe(\"deleteCompany\", deleteCompany);\nClientEvents.subscribe(\"changeActiveCompany\", (eventData) => {\n    status = eventData.value; \n    Database.readRecords(\"rodent\", \"Companies\", function(eventData) {\n        companiesCollection = SensaCollection.load(eventData.value);\n        updateTable(companiesTable, companiesCollection);\n    });\n    if (status !== \"Show Active\") {\n        // Do not attempt to delete inactive elements\n        Script.hideWidget(\"deleteCompanyIcon\");\n    } else {\n        // Re-enable widgets if hidden before\n        Script.showWidget(\"deleteCompanyIcon\");\n    }\n});\n \nScript.on('load', function() {\n\n    Database.readRecords(\"rodent\", \"Companies\", function(eventData) {\n        companiesCollection = SensaCollection.load(eventData.value);\n        updateTable(companiesTable, companiesCollection);\n    });\n});\n \nfunction updateTable(table, collection) {\n    let filteredCollection = collection.query((record, pk) => {\n        if (record['Status'] == (status == \"Show Active\")) {\n            return true;\n        }\n    });\n    \n    ClientEvents.publish(\"clearAllCompanies\", \"\");\n    table.receiveValue(filteredCollection);\n}\n \nfunction editCompany(eventData) {\n    Script.setState(\"companyData\", eventData.value);\n    Script.setState(\"modifyType\", \"edit\");\n    Client.jumpToScreen(\"Edit Company\");\n}\n\nfunction addCompany() {\n    Script.setState(\"modifyType\", \"add\");\n    Client.jumpToScreen(\"Edit Company\");\n}\n\nfunction deleteCompany() {\n    var formData = Script.getFormByKey(\"company\");\n    var ids = formData.company.getColumn(\"id\");\n    for (var i = 0; i < ids.length; i++) {\n        companiesTable.deleteRows(ids[i]);\n        let req = {};\n        req[{\"Id\": ids[i], \"Status\": \"0\"}] = {\"Id\": ids[i], \"Status\": \"0\"};\n        Database.updateRecord(\"rodent\", \"Companies\", req);\n    }\n}"},"ev":{}},"companiesTable":{"t":"Table","lX":55,"lY":78,"sX":11.45,"sY":5.55,"s":"Manage Companies","ps":{"enabled":"true","scalingType":"OK","width":"90.66%","height":"76.48%","x":"4.44%","y":"10.76%"},"ver":"190104c210519","dis":false,"tt":"","a":{"text color":"#000000","row color":"#000000","columns":"name,address","form id":"company","form key":"company","title":"Companies","colWidths":"0.6299212598425197,0.326334208223972","display header":"true","selectable":"multi + single"},"ev":{"clientEvents":{"inputEvents":{"Delete Rows":{"channel":"clearAllCompanies/delete all rows","event":"delete all rows","important":"false"}},"outputEvents":{"Edit Company":{"channel":"editCompany/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"deleteCompanyIcon":{"t":"Icon","lX":61,"lY":647,"sX":1,"sY":1,"s":"Manage Companies","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"50px","height":"6.89%","x":"4.91%","y":"89.12%"},"ver":"200628c210519","dis":false,"tt":"","a":{"outline color":"no outline","icon file":"trash","hover":"red"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"deleteCompany/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"addCompanyIcon":{"t":"Icon","lX":124,"lY":647,"sX":1,"sY":1,"s":"Manage Companies","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"50px","height":"6.89%","x":"9.97%","y":"89.12%"},"ver":"200628c210519","dis":false,"tt":"","a":{"outline color":"no outline","icon file":"plus-square"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"addCompany/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"companyContainer":{"t":"Container","lX":57,"lY":30,"sX":5.73,"sY":3.4,"s":"Edit Company","ps":{"enabled":"true","scalingType":"OK","width":"45.33%","height":"46.83%","x":"4.53%","y":"4.13%"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"color":"grey","title":"Title"},"ev":{}},"Input#0":{"t":"Input","lX":65,"lY":155,"sX":5.5,"sY":1,"s":"Edit Company","ps":{"enabled":"true","scalingType":"NOVERT","width":"43.52%","height":"7.3%","x":"5.89%","y":"12.8%"},"ver":"270520c210519","dis":false,"tt":"","a":{"label text":"Name","color":"grey","form id":"companyform","form key":"Name","required":"true"},"ev":{}},"Input#1":{"t":"Input","lX":77,"lY":184,"sX":5.5,"sY":1,"s":"Edit Company","ps":{"enabled":"true","scalingType":"NOVERT","width":"43.52%","height":"7.3%","x":"6.07%","y":"25.41%"},"ver":"270520c210519","dis":false,"tt":"","a":{"label text":"Address","color":"grey","form id":"companyform","form key":"Address","required":"true"},"ev":{}},"Input#7":{"t":"Input","lX":69,"lY":195,"sX":1.15,"sY":1,"s":"Edit Company","ps":{"enabled":"true","scalingType":"NOVERT","width":"9.07%","height":"7.3%","x":"5.44%","y":"41.42%"},"ver":"270520c210519","dis":false,"tt":"","a":{"type":"checkbox","checkbox label side":"right","label text":"Enabled","form id":"companyform","form key":"Status","default value":"1"},"ev":{}},"companySubmitButton":{"t":"Button","lX":498,"lY":301,"sX":1.15,"sY":1,"s":"Edit Company","ps":{"enabled":"true","scalingType":"OK","width":"9.07%","height":"6.34%","x":"39.44%","y":"41.42%"},"ver":"190104c210519","dis":false,"tt":"","a":{"color":"orange strong","button name":"Submit"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"finishSubmitCompany/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"Scripting#3":{"t":"Scripting","lX":50,"lY":435,"sX":1,"sY":1,"s":"Edit Company","ps":{"enabled":"false","scalingType":"OK","width":"9.07%","height":"8.26%","x":"4.53%","y":"35.92%"},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\nvar companyId;\nvar modifyType;\nconst companyContainer = Script.getWidget(\"companyContainer\");\nconst companySubmitButton = Script.getWidget(\"companySubmitButton\");\nconst canceCompanyBtn = Script.getWidget(\"canceCompanyBtn\");\nScript.on('load', function() {\n\t\n\tcanceCompanyBtn.subscribe(\"pressed\", ()=> {\n\t\t Client.jumpToScreen(\"Manage Companies\");\n\t});\n    modifyType = Script.getState(\"modifyType\");\n    var companyData;\n\n    if (modifyType == \"add\") {\n        companyContainer.setTitle(\"New Company\");\n        return;\n    } else if (modifyType == \"edit\") {\n        companyData = Script.getState(\"companyData\");\n    }\n\n    var companyObj = {}\n    companyId = companyData.getColumn(\"id\")[0];\n    companyObj.Name = companyData.getColumn(\"name\");\n    companyObj.Address = companyData.getColumn(\"address\");\n    companyObj.Status = companyData.getColumn(\"status\");\n\n    Script.setForm(\"companyform\", companyObj);\n    companyContainer.setTitle(\"Edit Company\");\n});\n\nClientEvents.subscribe(\"finishSubmitCompany\", function() {\n    switch (modifyType) {\n        case 'edit':\n            handleEdit();\n            break;\n        case 'add':\n            handleCreate();\n            break;\n    }\n});\n\nfunction handleEdit() {\n    var formObj = Script.getFormByKey(\"companyform\");\n    if (formObj == undefined) {\n        alert(\"Please fill out all required fields\");\n        return;\n    }\n        \n    var dbReq = {};\n    formObj.Id = companyId;\n    formObj.Status = +formObj.Status;\n    let today = new Date();\n    today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n    formObj.UpdatedOn = today;\n    formObj.UpdatedBy = Client.getUser();\n    dbReq[companyId] = formObj;\n        \n    Database.updateRecord(\"rodent\", \"Companies\", dbReq, () => {\n        Client.jumpToScreen(\"Manage Companies\");\n    });\n}\n\nfunction handleCreate() {\n    Database.readRecords(\"rodent\", \"Companies\", function(eventData) {\n        var companyCollection = SensaCollection.load(eventData.value);\n        var formObj = Script.getFormByKey(\"companyform\");\n        \n        if (formObj == undefined) {\n            alert(\"Please fill out all required fields\");\n            return;\n        }\n\n        var dbReq = {};\n        var companyCount = Object.keys(companyCollection.data).length;\n        formObj.Id = `${companyCount + 1}`;\n        formObj.Status = +formObj.Status;\n\n        let today = new Date();\n        today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n        formObj.CreatedOn = today;\n        formObj.UpdatedOn = today;\n        formObj.CreatedBy = Client.getUser();\n        formObj.UpdatedBy = Client.getUser();\n        dbReq[companyCount + 1] = formObj;\n\n        Database.createRecords(\"rodent\", \"Companies\", dbReq, () => {\n            \n            Client.jumpToScreen(\"Manage Companies\");\n        });\n    });\n}"},"ev":{}},"editUserIsAdmin":{"t":"Input","lX":34,"lY":351,"sX":1.49,"sY":1,"s":"Edit User Role","ps":{"enabled":"true","scalingType":"NOVERT","width":"11.81%","height":"7.3%","x":"2.7%","y":"48.35%"},"ver":"270520c210519","dis":false,"tt":"","a":{"label text":"Is Admin","type":"checkbox","checkbox label side":"right","form id":"editUser","form key":"IsAdmin"},"ev":{}},"deviceModelDropdown":{"t":"Dropdown","lX":949,"lY":97,"sX":2,"sY":1,"s":"Error Codes","ps":{"enabled":"true","scalingType":"NOVERT","width":"200px","height":"7.3%","x":"76.17%","y":"13.64%"},"ver":"190104c210519","dis":false,"tt":"","a":{"default options":""},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"deviceModelSelected/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"errorModelDropdown":{"t":"Dropdown","lX":72,"lY":245,"sX":4.64,"sY":1,"s":"Edit Error Codes","ps":{"enabled":"true","scalingType":"NOVERT","width":"36.74%","height":"7.3%","x":"5.7%","y":"31.72%"},"ver":"190104c210519","dis":false,"tt":"","a":{"default options":"","form id":"errorcode","form key":"ModelId","label text":"Device Model","disable edit":"false"},"ev":{}},"modelTypesTable":{"t":"Table","lX":49,"lY":89,"sX":11.05,"sY":3.2,"s":"Manage Model Types","ps":{"enabled":"true","scalingType":"OK","width":"87.46%","height":"44.08%","x":"3.91%","y":"12.28%"},"ver":"190104c210519","dis":false,"tt":"","a":{"text color":"#000000","row color":"#000000","columns":"name","form id":"modelType","title":"Model Types","form key":"modelType","selectable":"multi + single","display header":"true","colWidths":"0.9540863177226814"},"ev":{"clientEvents":{"inputEvents":{"Delete Modal Type":{"channel":"clearAllModalTypes/delete all rows","event":"delete all rows","important":"false"}},"outputEvents":{"Edit Modal Type":{"channel":"editModalType/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"deleteModalTypeIcon":{"t":"Icon","lX":50,"lY":422,"sX":1.12,"sY":1.12,"s":"Manage Model Types","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"4.42%","height":"7.71%","x":"3.96%","y":"58.06%"},"ver":"200628c210519","dis":false,"tt":"","a":{"icon file":"trash","outline color":"no outline","hover":"red"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"deleteModalType/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"addModalTypeIcon":{"t":"Icon","lX":152,"lY":422,"sX":1.12,"sY":1.12,"s":"Manage Model Types","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"4.42%","height":"7.71%","x":"9%","y":"58.06%"},"ver":"200628c210519","dis":false,"tt":"","a":{"icon file":"plus-square","outline color":"no outline"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"addModalType/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"modelTypeSubmitButton":{"t":"Button","lX":588,"lY":195,"sX":1.3,"sY":1,"s":"Edit Model Type","ps":{"enabled":"true","scalingType":"OK","width":"10.33%","height":"6.34%","x":"45.54%","y":"26.81%"},"ver":"190104c210519","dis":false,"tt":"","a":{"color":"orange strong","button name":"Submit"},"ev":{"clientEvents":{"outputEvents":{"Submit":{"channel":"finishSubmitModalType/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"modelTypeContainer":{"t":"Container","lX":81,"lY":34,"sX":6.54,"sY":2.35,"s":"Edit Model Type","ps":{"enabled":"true","scalingType":"OK","width":"51.79%","height":"32.37%","x":"6.41%","y":"4.63%"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"color":"grey","title":"Edit Model Type"},"ev":{}},"modelsTable":{"t":"Table","lX":105,"lY":58,"sX":6.48,"sY":3.05,"s":"Manage Device Models","ps":{"enabled":"true","scalingType":"OK","width":"51.3%","height":"42.01%","x":"8.33%","y":"8.01%"},"ver":"190104c210519","dis":false,"tt":"","a":{"text color":"#000000","row color":"#000000","columns":"name,model type,battery upper,battery lower","form id":"models","form key":"models","selectable":"multi + single","display header":"true","title":"Models","colWidths":"0.23219814241486067,0.2306501547987616,0.22910216718266255,0.2306501547987616"},"ev":{"clientEvents":{"inputEvents":{"Delete all Rows":{"channel":"userDelModels/delete all rows","event":"delete all rows","important":"false"}},"outputEvents":{"Edit Model":{"channel":"editModel/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"modelTypesDropdown":{"t":"Dropdown","lX":498,"lY":39,"sX":2.34,"sY":1,"s":"Manage Device Models","ps":{"enabled":"true","scalingType":"NOVERT","width":"18.5%","height":"7.3%","x":"39.44%","y":"5.34%"},"ver":"190104c210519","dis":false,"tt":"","a":{"default options":""},"ev":{"clientEvents":{"outputEvents":{"Model Type Select":{"channel":"modelTypeSelected/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"deleteModelIcon":{"t":"Icon","lX":117,"lY":374,"sX":1.06,"sY":1.06,"s":"Manage Device Models","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"4.21%","height":"7.3%","x":"9.25%","y":"51.5%"},"ver":"200628c210519","dis":false,"tt":"","a":{"icon file":"trash","outline color":"no outline","hover":"red"},"ev":{"clientEvents":{"outputEvents":{"Delete Model":{"channel":"deleteModel/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"modelTypeSelect":{"t":"Dropdown","lX":135,"lY":155,"sX":5.26,"sY":1,"s":"Edit Model","ps":{"enabled":"true","scalingType":"NOVERT","width":"41.63%","height":"7.3%","x":"11.35%","y":"27.4%"},"ver":"190104c210519","dis":false,"tt":"","a":{"form id":"modelForm","form key":"ModelType","default options":"","label text":"Model Type"},"ev":{}},"modelSubmit":{"t":"Button","lX":560,"lY":436,"sX":1.06,"sY":1,"s":"Edit Model","ps":{"enabled":"true","scalingType":"OK","width":"8.41%","height":"6.34%","x":"44.32%","y":"59.99%"},"ver":"190104c210519","dis":false,"tt":"","a":{"color":"orange strong","outline color":"orange strong","button name":"Submit"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"finishEditModel/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"modelFormContainer":{"t":"Container","lX":106,"lY":63,"sX":6.11,"sY":4.4,"s":"Edit Model","ps":{"enabled":"true","scalingType":"OK","width":"48.36%","height":"60.65%","x":"8.41%","y":"8.9%"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"color":"grey","title":"Title"},"ev":{}},"addModalIcon":{"t":"Icon","lX":181,"lY":465,"sX":1.06,"sY":1.06,"s":"Manage Device Models","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"4.21%","height":"7.3%","x":"14.3%","y":"51.5%"},"ver":"200628c210519","dis":false,"tt":"","a":{"icon file":"plus-square","outline color":"no outline"},"ev":{"clientEvents":{"outputEvents":{"Add Model":{"channel":"addModel/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"activeModelTypeDropDown":{"t":"Dropdown","lX":839,"lY":78,"sX":3.11,"sY":1,"s":"Manage Model Types","ps":{"enabled":"true","scalingType":"NOVERT","width":"24.66%","height":"7.3%","x":"66.46%","y":"9.79%"},"ver":"190104c210519","dis":false,"tt":"","a":{"default options":"Show Active, Show Inactive","default value":"Show Active"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"changeActiveModalType/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"modelTypeScript":{"t":"Scripting","lX":35,"lY":560,"sX":1,"sY":1,"s":"Manage Model Types","ps":{"enabled":"false","scalingType":"OK","width":"15.77%","height":"17.79%","x":"19.56%","y":"76.51%"},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\nconst modelTypesTable = Script.getWidget(\"modelTypesTable\");\n \nvar modelTypesCollection;\n \nvar status = \"Show Active\";\n\nClientEvents.subscribe(\"editModalType\", editModalType);\nClientEvents.subscribe(\"addModalType\", addModalType);\nClientEvents.subscribe(\"deleteModalType\", deleteModalType);\nClientEvents.subscribe(\"changeActiveModalType\", (eventData) => {\n    status = eventData.value; \n    Database.readRecords(\"rodent\", \"ModelType\", function(eventData) {\n        modelTypesCollection = SensaCollection.load(eventData.value);\n        updateTable(modelTypesTable, modelTypesCollection);\n    });\n    if (status !== \"Show Active\") {\n        // Do not attempt to delete inactive elements\n        Script.hideWidget(\"deleteModalTypeIcon\");\n    } else {\n        // Re-enable widgets if hidden before\n        Script.showWidget(\"deleteModalTypeIcon\");\n    }\n});\n\nScript.on('load', function() {\n\tDatabase.readRecords(\"rodent\", \"ModelType\", function(eventData) {\n        modelTypesCollection = SensaCollection.load(eventData.value);\n\t\tupdateTable(modelTypesTable, modelTypesCollection);\n    });\n});\n\nfunction updateTable(table, collection) {\n    let filteredCollection = collection.query((record, pk) => {\n        if (record['Status'] == (status == \"Show Active\")) {\n            return true;\n        }\n    });\n    ClientEvents.publish(\"clearAllModalTypes\", \"\");\n    table.receiveValue(filteredCollection);\n}\n \nfunction editModalType(eventData) {\n    Script.setState(\"modelTypeData\", eventData.value);\n    Script.setState(\"modifyType\", \"edit\");\n    Client.jumpToScreen(\"Edit Model Type\");\n}\n\nfunction addModalType() {\n    Script.setState(\"modifyType\", \"add\");\n    Client.jumpToScreen(\"Edit Model Type\");\n}\n\nfunction deleteModalType() {\n    var formData = Script.getFormByKey(\"modelType\");\n    var ids = formData.modelType.getColumn(\"id\");\n    for (var i = 0; i < ids.length; i++) {\n        modelTypesTable.deleteRows(ids[i]);\n        let req = {};\n        req[{\"Id\": ids[i], \"Status\": \"0\"}] = {\"Id\": ids[i], \"Status\": \"0\"};\n        Database.updateRecord(\"rodent\", \"ModelType\", req);\n    }\n}"},"ev":{}},"modelTypeNameInput":{"t":"Input","lX":104,"lY":146,"sX":6.15,"sY":1,"s":"Edit Model Type","ps":{"enabled":"true","scalingType":"NOVERT","width":"48.71%","height":"7.3%","x":"8.26%","y":"15.11%"},"ver":"270520c210519","dis":false,"tt":"","a":{"form id":"modalTypeForm","form key":"Name","required":"true","label text":"Name","color":"grey"},"ev":{}},"modelTypeEnabledCheckbox":{"t":"Input","lX":113,"lY":195,"sX":1.56,"sY":1,"s":"Edit Model Type","ps":{"enabled":"true","scalingType":"NOVERT","width":"12.33%","height":"7.3%","x":"7.91%","y":"26.81%"},"ver":"270520c210519","dis":false,"tt":"","a":{"form id":"modalTypeForm","form key":"Status","type":"checkbox","default value":"1","label text":"Enabled","checkbox label side":"right"},"ev":{}},"modelTypeSubmitScript":{"t":"Scripting","lX":40,"lY":595,"sX":1,"sY":1,"s":"Edit Model Type","ps":{"enabled":"false","scalingType":"OK","width":"12.33%","height":"17.79%","x":"6.29%","y":"70.28%"},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\nvar modelTypeId;\nvar modifyType;\nconst modelTypeContainer = Script.getWidget(\"modelTypeContainer\");\nconst modelTypeSubmitButton = Script.getWidget(\"modelTypeSubmitButton\");\nconst cancelModelType = Script.getWidget(\"cancelModelType\");\nScript.on('load', function() {\n    modifyType = Script.getState(\"modifyType\");\n    var modelTypeData;\n\t\n\tcancelModelType.subscribe(\"pressed\", ()=> {\n\t\tClient.jumpToScreen(\"Manage Model Types\");\n\t});\n\tif (modifyType == \"add\") {\n        modelTypeContainer.setTitle(\"New Model Type\");\n        return;\n    } else if (modifyType == \"edit\") {\n        modelTypeData = Script.getState(\"modelTypeData\");\n    }\n    var modelTypeObj = {};\n    modelTypeId = modelTypeData.getColumn(\"id\")[0];\n    modelTypeObj.Name = modelTypeData.getColumn(\"name\");\n    modelTypeObj.Status = modelTypeData.getColumn(\"status\");\n\n    Script.setForm(\"modalTypeForm\", modelTypeObj);\n    modelTypeContainer.setTitle(\"Edit Model Type\");\n});\n\n\nClientEvents.subscribe(\"finishSubmitModalType\", function() {\n    switch (modifyType) {\n        case 'edit':\n            handleEdit();\n            break;\n        case 'add':\n            handleCreate();\n            break;\n    }\n});\n\nfunction handleEdit() {\n    var formObj = Script.getFormByKey(\"modalTypeForm\");\n    if (formObj == undefined) {\n        alert(\"Please fill out all required fields\");\n        return;\n    }\n    var dbReq = {};\n    formObj.Id = modelTypeId;\n    formObj.Status = +formObj.Status;\n    let today = new Date();\n    today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n    formObj.UpdatedOn = today;\n    formObj.UpdatedBy = Client.getUser();\n    dbReq[modelTypeId] = formObj;\n\tdebugger;\n    Database.updateRecord(\"rodent\", \"ModelType\", dbReq, () => {\n        Client.jumpToScreen(\"Manage Model Types\");\n    });\n}\n\nfunction handleCreate() {\n    Database.readRecords(\"rodent\", \"ModelType\", function(eventData) {\n        var modelTypeCollection = SensaCollection.load(eventData.value);\n        var formObj = Script.getFormByKey(\"modalTypeForm\");\n        if (formObj == undefined) {\n            alert(\"Please fill out all required fields\");\n            return;\n        }\n        var dbReq = {};\n        var modelTypeCount = Object.keys(modelTypeCollection.data).length;\n        formObj.Id = `${modelTypeCount + 1}`;\n        formObj.Status = +formObj.Status;\n        let today = new Date();\n        today = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n        formObj.CreatedOn = new Date().getTime();\n        formObj.UpdatedOn =  new Date().getTime();\n        formObj.CreatedBy = Client.getUser();\n        formObj.UpdatedBy = Client.getUser();\n        dbReq[modelTypeCount + 1] = formObj;\n\t\tdebugger;\n        Database.createRecords(\"rodent\", \"ModelType\", dbReq, () => {\n            Client.jumpToScreen(\"Manage Model Types\");\n        });\n    });\n}"},"ev":{}},"modelScript":{"t":"Scripting","lX":1000,"lY":55,"sX":1,"sY":1,"s":"Manage Device Models","ps":{"enabled":"false","scalingType":"OK","width":"8.41%","height":"17.79%","x":"84.19%","y":"9.79%"},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\n \nvar modelCollection;\nvar currentModelType;\nvar modelTypesCollection;\n\nconst modelTypesTable = Script.getWidget(\"modelsTable\");\nconst compDropdown = Script.getWidget(\"modelTypesDropdown\");\n\nClientEvents.subscribe(\"modelTypeSelected\", changeModel);\nClientEvents.subscribe(\"deleteModel\", deleteModel);\nClientEvents.subscribe(\"editModel\", editModel);\nClientEvents.subscribe(\"addModel\", addModel);\n\nScript.on('load', function() {\n\tDatabase.readRecords(\"rodent\", \"ModelType\", function(eventData) {\n\t\tmodelTypesCollection = SensaCollection.load(eventData.value);\n\t\tDatabase.readRecords(\"rodent\", \"Model\", function(eventData) {\n\t\t\tmodelCollection = SensaCollection.load(eventData.value);\n\t\t\tcurrentModelType = Script.getState(\"currentModelType\");\n\t\t\tlet modelTypeNames = modelTypesCollection.getColumn(\"Name\");\n\t\t\tlet modelTypeIds = modelTypesCollection.getColumn(\"Id\");\n\t\t\tif (currentModelType == null) {\n\t\t\t  currentModelType = modelTypeIds[0];\n\t\t\t}\n\t\t\tlet modelTypeObj = {};\n\t\t\tmodelTypeIds.map((model, idx) => {\n\t\t\t\tmodelTypeObj[model] = modelTypeNames[idx];\n\t\t\t});\n\t\t\tObject.keys(modelTypeObj).forEach((model, idx) => {\n\t\t\t\tmodelTypesCollection.set({\"Id\": model, \"Name\": modelTypeObj[model]});\n\t\t\t});\n\t\t    modelTypesCollection.renameColumn(\"Name\", \"text\");\n\t\t\tmodelTypesCollection.renameColumn(\"Id\", \"value\");\n\t\t\tcompDropdown.receiveTextValues(modelTypesCollection);\n\t\t\tcompDropdown.receiveValue(modelTypeObj[currentModelType]);\n\t\t    modelTypesCollection.renameColumn(\"text\", \"Name\");\n\t\t\tmodelTypesCollection.renameColumn(\"value\", \"Id\");\n\t\t\tupdateTable();\n\t\t});\n\t});\n});\n\nfunction updateTable() {\n      let filteredModels = modelCollection.query((record, pk) => {\n          if ((record['ModelType'] == currentModelType) &&\n              (record['Status'] == '1')){\n              return true;\n          }\n      });\n\t  let modelTypeName = modelTypesCollection.query((modelType, pk) => {\n\t\t  if (modelType['Id'] == currentModelType){\n\t\t\t  return true;\n\t\t  }\n\t  }).getFirst();\n\t  filteredModels.forEach((model, pk) => {\n          filteredModels.set({\"Id\": model['Id'], \"ModelType\": modelTypeName['Name']});\n      });\n\t//name,model type,battery upper,battery lower\n      ClientEvents.publish(\"userDelModels\", \"\");\n\t  filteredModels.renameColumn(\"ModelType\", \"Model Type\");\n\t  filteredModels.renameColumn(\"BatteryUpper\", \"Battery Upper\");\n\t  filteredModels.renameColumn(\"BatteryLower\", \"Battery Lower\");\n      modelTypesTable.receiveValue(filteredModels);\n}\n\nfunction changeModel(selected) {\n\tcurrentModelType = selected.value;\n    updateTable();\n}\n\nfunction deleteModel() {\n     let formData = Script.getFormByKey(\"models\");\n     var ids = formData.models.getColumn(\"id\");\n     for (var i = 0; i < ids.length; i++) {\n          modelTypesTable.deleteRows(ids[i]);\n          Database.deleteRecord(\"rodent\", \"Model\", \"Id\", ids[i]);\n     }\n}\n\nfunction editModel(eventData) {\n    Script.setState(\"modelInfo\", eventData.value);\n    Script.setState(\"currentModelType\", currentModelType);\n    Script.setState(\"modifyType\", \"edit\");\n    Client.jumpToScreen(\"Edit Model\");\n}\n\n function addModel() {\n     Script.setState(\"currentModelType\", currentModelType);\n     Script.setState(\"modifyType\", \"add\");\n     Client.jumpToScreen(\"Edit Model\");\n }"},"ev":{}},"modelNameInput":{"t":"Input","lX":135,"lY":95,"sX":5.41,"sY":1,"s":"Edit Model","ps":{"enabled":"true","scalingType":"NOVERT","width":"42.81%","height":"7.3%","x":"11.27%","y":"16.55%"},"ver":"270520c210519","dis":false,"tt":"","a":{"form id":"modelForm","form key":"Name","label text":"Name","required":"true","color":"grey"},"ev":{}},"modelSubmitScript":{"t":"Scripting","lX":100,"lY":435,"sX":1,"sY":1,"s":"Edit Model","ps":{"enabled":"false","scalingType":"OK","width":"8.41%","height":"17.79%","x":"8.41%","y":"77.58%"},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\nvar userId;\nvar modifyType;\nvar modelTypeId;\nvar modelData;\n\nconst modelFormContainer = Script.getWidget(\"modelFormContainer\");\n//const userSubmitButton = Script.getWidget(\"userRoleSubmit\");\nconst modelTypeSelect = Script.getWidget(\"modelTypeSelect\");\nconst cancelModelBtn = Script.getWidget(\"cancelModelBtn\");\n\nScript.on('load', function() {\n\t\n\tcancelModelBtn.subscribe(\"pressed\", ()=> {\n\t\tClient.jumpToScreen(\"Manage Device Models\");\n\t});\n\tmodifyType = Script.getState(\"modifyType\");\n\tif (modifyType == \"add\") {\n        modelFormContainer.setTitle(\"New User Role\");\n    } else if (modifyType == \"edit\") {\n        modelData = Script.getState(\"modelInfo\");\n\t\tmodelFormContainer.setTitle(\"Edit User Role\");\n\t\tif(modelData != null){\n\t\t\tvar modelObj = {};\n\t\t\tmodelObj.Name = modelData.getColumn(\"name\");\n\t\t\tmodelObj.BatteryLower = modelData.getColumn(\"batterylower\");\n\t\t\tmodelObj.BatteryUpper = modelData.getColumn(\"batteryupper\");\n\t\t\tScript.setForm(\"modelForm\", modelObj);\n\t\t}\n    }\n\tDatabase.readRecords(\"rodent\", \"ModelType\", function(eventData) {\n\t\tlet modelTypesCollection = SensaCollection.load(eventData.value);\n\t\tlet modelTypeNames = modelTypesCollection.getColumn(\"Name\");\n\t\tlet modelTypeIds = modelTypesCollection.getColumn(\"Id\");\n\t\tmodelTypeId = Script.getState(\"currentModelType\");\n\t\tif (modelTypeId == null) {\n\t\t\tmodelTypeId = compIds[0];\n\t\t}\n\t\tlet modelTypeObj = {};\n\t\t modelTypeIds.map((model, idx) => {\n\t\t\t modelTypeObj[model] = modelTypeNames[idx];\n\t\t });\n\t\t Object.keys(modelTypeObj).forEach((model, idx) => {\n\t\t\t modelTypesCollection.set({\"Id\": model, \"Name\": modelTypeObj[model]});\n\t\t });\n\t\t modelTypesCollection.renameColumn(\"Name\", \"text\");\n\t\t modelTypesCollection.renameColumn(\"Id\", \"value\");\n\t\t modelTypeSelect.receiveTextValues(modelTypesCollection);\n\t\t modelTypeSelect.receiveValue(modelTypesCollection.get(modelTypeId).text);\n\t});\n});\n\nClientEvents.subscribe(\"finishEditModel\", function() {\n\tswitch (modifyType) {\n\t\tcase 'edit':\n\t\t\thandleEdit();\n\t\t\tbreak;\n\t\tcase 'add':\n\t\t\thandleCreate();\n\t\t\tbreak;\n\t}\n});\n\nfunction handleEdit() {\n\tvar formObj = Script.getFormByKey(\"modelForm\");\n\tif (formObj == undefined) {\n\t\talert(\"Please fill out all required fields\");\n\t\treturn;\n\t}\n\tvar dbReq = {};\n\tlet today = new Date();\n\ttoday = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n\tformObj.UpdatedOn = today;\n\tformObj.UpdatedBy = Client.getUser();\n\tlet modelData = Script.getState(\"modelInfo\");\n    let modelId = modelData.getColumn(\"id\")[0];\n\tformObj.Id = modelId;\n\tdbReq[modelId] = formObj;\n\tDatabase.updateRecord(\"rodent\", \"Model\", dbReq, () => {\n\t\tScript.setState(\"currentModelType\", formObj.ModelType);\n\t\tClient.jumpToScreen(\"Manage Device Models\");\n    });\n}\n\nfunction handleCreate() {\n\tDatabase.readRecords(\"rodent\", \"Model\", function(eventData) {\n\t\tlet modelCollection = SensaCollection.load(eventData.value);\n\t\tvar formObj = Script.getFormByKey(\"modelForm\");\n\t\tif (formObj == undefined) {\n\t\t\talert(\"Please fill out all required fields\");\n\t\t\treturn;\n\t\t}\n\t\tvar dbReq = {};\n\t\tlet today = new Date();\n\t\ttoday = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);\n\t\tlet id = +modelCollection.getColumn(\"Id\").at(-1) + 1;\n\t\tformObj.Id = `${id}`;\n\t\tformObj.CreatedOn = today;\n\t\tformObj.UpdatedOn = today;\n\t\tformObj.CreatedBy = Client.getUser();\n        formObj.UpdatedBy = Client.getUser();\n\t\tdbReq[id] = formObj;\n\t\tDatabase.createRecords(\"rodent\", \"Model\", dbReq, () => {\n\t\tScript.setState(\"currentModelType\", formObj.ModelType);\n\t\tClient.jumpToScreen(\"Manage Device Models\");\n         });\n\t});\n}"},"ev":{}},"modelBatteryUpperInput":{"t":"Input","lX":135,"lY":220,"sX":5.36,"sY":1,"s":"Edit Model","ps":{"enabled":"true","scalingType":"NOVERT","width":"42.47%","height":"7.3%","x":"11.35%","y":"39.15%"},"ver":"270520c210519","dis":false,"tt":"","a":{"form id":"modelForm","form key":"BatteryUpper","label text":"Battery Upper","color":"grey"},"ev":{}},"modelBatteryLowerInput":{"t":"Input","lX":147,"lY":369,"sX":5.36,"sY":1,"s":"Edit Model","ps":{"enabled":"true","scalingType":"NOVERT","width":"42.47%","height":"7.3%","x":"11.61%","y":"50.89%"},"ver":"270520c210519","dis":false,"tt":"","a":{"form id":"modelForm","form key":"BatteryLower","label text":"Battery Lower","color":"grey"},"ev":{}},"packetContainer":{"t":"Container","lX":25,"lY":75,"sX":12.43,"sY":6.95,"s":"Packet 6 Transactions","ps":{"enabled":"true","scalingType":"OK","width":"98.42%","height":"95.73%","x":"2%","y":"10.27%"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"title":"Transaction Table","color":"grey"},"ev":{}},"tableCtl":{"t":"PickSlider","lX":19,"lY":109,"sX":6.04,"sY":1,"s":"Packet 6 Transactions","ps":{"enabled":"true","scalingType":"NOVERT","width":"95.58%","height":"6.89%","x":"4.53%","y":"15.3%"},"ver":"190104c210519","dis":false,"tt":"","a":{"tick values":"Week,Month,3Months,Year"},"ev":{"clientEvents":{"outputEvents":{"interval Set":{"channel":"intervalSet/receive value","event":"changed","trigger":"changed","important":"false"}}}}},"downloadData":{"t":"Button","lX":1150,"lY":698,"sX":1.22,"sY":1,"s":"Packet 6 Transactions","ps":{"enabled":"true","scalingType":"OK","width":"9.65%","height":"6.34%","x":"91.16%","y":"98.11%"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":"Download Data","color":"orange strong","outline color":"orange strong","text color":"white"},"ev":{}},"packet6Script":{"t":"Scripting","lX":25,"lY":775,"sX":1,"sY":1,"s":"Packet 6 Transactions","ps":{"enabled":"false","scalingType":"OK","width":"","height":"","x":"","y":""},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\nconst transactionTable = Script.getWidget(\"transactionTable\");\nvar transactionDataCollection = null;\n\nconst tableSlider = Script.getWidget(\"tableCtl\");\n\nvar intervalMap = {\"Week\": 7,\n\t\t\t\t\t\"Month\": 30,\n\t\t\t\t\t\"3Months\": 90,\n\t\t\t\t\t\"Year\": 365};\n\n\nvar locationData = [\n        {\n            \"TableName\": \"Locations\", // Specify the primary table used to construct the join request\n            \"Join\": 1, // Join type 1 - Inner Join, 2 - Outer Join, 3 - Left join, 4 - Right Join.\n            \"Columns\":\n            [\n            \"Id\",\n\t\t\t\"Name\"\n            \n            ], // Specify the list of columns to take from the reference table.\n\t\t\t// Specify the list of columns to take from the reference table.\n        \n\n }];\n\n\nvar siteData = [\n        {\n            \"TableName\": \"Sites\", // Specify the primary table used to construct the join request\n            \"Join\": 1, // Join type 1 - Inner Join, 2 - Outer Join, 3 - Left join, 4 - Right Join.\n            \"Columns\":\n            [\n            \"Id\",\n\t\t\t\"Name\"\n            \n            ], // Specify the list of columns to take from the reference table.\n\t\t\t// Specify the list of columns to take from the reference table.\n        \n\n }];\nvar selectPacket = [\n        {\n            \"TableName\": \"P6Transactions\", // Specify the primary table used to construct the join request\n            \"Join\": 1, // Join type 1 - Inner Join, 2 - Outer Join, 3 - Left join, 4 - Right Join.\n            \"Columns\":\n            [\n            \"DateTime\",\n            \"DeviceNumber\", \n            \"P5Total\",\n            \"IRLeft\",\n            \"IRRight\",\n\t\t\t\"AvgDelta\",\n\t\t\t\"MinDelta\",\n\t\t\t\"MaxDelta\",\n\t\t\t\"L1\",\n\t\t\t\"L2\",\n\t\t\t\"Range\",\n\t\t\t\"RebaitRange\",\n\t\t\t\"TakenG\",\n\t\t\t\"LocationId\",\n\t\t\t\"SiteId\"\n            ], // Specify the list of columns to take from the reference table.\n\t\t\t// Specify the list of columns to take from the reference table.\n        \n\n        }];\n\nconst tableColumns = [\"date time\",\"device number\", \"p5 total\",\"irleft\", \"irright\", \"average\", \"mindelta\", \"maxdelta\", \"l1\", \"l2\", \"range\", \"rebait range\",\"takeng\", \"location\", \n\t\t\t\t\t  \"site\"];\nScript.on('load', function() {\n\t\n\tlet downloadBtn = Script.getWidget(\"downloadData\");\n\t\n     downloadBtn.subscribe(\"pressed\", (eventData) => {\n\t \n       Script.downloadCSV(\"packet_6_data.csv\", transactionDataCollection);\n     });\n\t\n\tClientEvents.subscribe(\"intervalSet\", function(timeData) {\n\t\tvar slideValue = timeData.value;\n\t\tsortData(slideValue);\n\t\t\n\t });\n\t\n\tsortData(\"Week\");\n\t\n});\n\n\n/**\n* Sort and populate the data in the table\n*/\nfunction sortData(timeValue) {\n\n\tDatabase.readCompound(\"rodent\", \"P6Transactions\", selectPacket, function(eventData){\n\t\tvar tableData = {};\n\t\ttransactionDataCollection = SensaCollection.load(eventData.value);\n\t\tconst date = Date.parse(new Date()); //new Date();\n\t\t\n\t\tvar slideData = intervalMap[timeValue];\n\t\t\n\t\tDatabase.readCompound(\"rodent\", \"Locations\", locationData, function(lData){\n\t\t\tvar locationCollection = SensaCollection.load(lData.value);\n\t\t\t//console.log(\"location \" + JSON.stringify(locationCollection, null, 4));\n\t\t\tfor(const packet in transactionDataCollection.data) {\n\t\t\t\t\n\t\t\t\tfor(const location in locationCollection.data) {\n\t\t\t\t\tif(transactionDataCollection.data[packet][13] === location) {\n\t\t\t\t\t\t\n\t\t\t\t\t\ttransactionDataCollection.data[packet][13] = locationCollection.data[location][1];\n\t\t\t\t\t\t//transactionDataCollection.data[packet][13] = parseFloat(deviceData.data[device][rebaitRangeIndex]).toFixed(2);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t\n\t\t\n\t\t//console.log(\"location \"+ \"  data s\" + dataS + JSON.stringify(dataS, null, 4));\n\t\tDatabase.readCompound(\"rodent\", \"Sites\", siteData, function(sDataEvents){\n\t\t\tvar siteCollection = SensaCollection.load(sDataEvents.value);\n\t\t\t//console.log(\"Site \" + JSON.stringify(siteCollection, null, 4));\n\t\t\tfor(const packet in transactionDataCollection.data) {\n\t\t\t\t\n\t\t\t\tfor(const site in siteCollection.data) {\n\t\t\t\t\tif(transactionDataCollection.data[packet][14] === site) {\n\t\t\t\t\t\t\n\t\t\t\t\t\ttransactionDataCollection.data[packet][14] = siteCollection.data[site][1];\n\t\t\t\t\t\t//transactionDataCollection.data[packet][13] = parseFloat(deviceData.data[device][rebaitRangeIndex]).toFixed(2);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar dataValue = transactionDataCollection.data[packet][0];\n\t\t\t\tvar dateDiff = date - parseInt(dataValue);\n\t\t\t\tvar daysMiliseconds = 86400000;\n\t\t\t\tvar days = (dateDiff / (60*60*24*1000)) % 365;\n\t\t\t\tif(days <= slideData || days > 365) {\n\t\t\t\t\t  transactionDataCollection.data[packet][0] = formatTime(transactionDataCollection.data[packet][0]);\n\t\t\t\t}\n\t\t\t\ttransactionDataCollection.data[packet][11] = parseFloat(transactionDataCollection.data[packet][11]).toFixed(2);\n\t\t\t\ttransactionDataCollection.data[packet][12] = parseFloat(transactionDataCollection.data[packet][12]).toFixed(2);\n\t\t\t\t\n\t\t\t}\n\t\t\n\t\t});\n\t\t//sort the date \n\t\t const data = Object.keys(transactionDataCollection.data).reverse().reduce(\n\t\t\t  (obj, key) => { \n\t\t\t\tobj[key] = transactionDataCollection.data[key]; \n\t\t\t\treturn obj;\n\t\t\t  }, \n\t\t  {}\n\t\t);\n\t\ttransactionDataCollection.data = data;\n\t\t\n\t\t// wait for 5 miliseconds for all the data to be extracted.\n\t\tdelay(100).then(() => {\n\t\t\ttransactionDataCollection.setColumns(tableColumns);\n\t\t\tupdateTable(transactionTable, transactionDataCollection);\n\t\t});\n\t});\n\n}\n\n/*Delay function*/\nfunction delay(time) {\n  return new Promise(resolve => setTimeout(resolve, time));\n}\n\n/**\n* Update data in the table\n*/\nfunction updateTable(table, collection){\n\tClientEvents.publish(\"deleteRows\", \"\");\n\ttable.receiveValue(collection);\n\n}\n\n//date time,device number,p5 total,irleft,irright,average,mindelta,maxdelta,l1,l2,range,rebait range,takeng,location,site\n/**\n* Format time from milisecond to Date and time format\n*/\nfunction formatTime(utcTime) {\n     var date = new Date(parseInt(utcTime)).toLocaleString('en-GB');\n     var d = date.split(\", \");\n     var d0 = d[0].split(\"/\");\n     d0[2] = Math.abs(d0[2] - 2000);\n     d0 = d0.join(\"/\");\n\t return d[1] + \" \" + d0;\n}"},"ev":{}},"transactionTable":{"t":"Table","lX":32,"lY":157,"sX":12.3,"sY":5.25,"s":"Packet 6 Transactions","ps":{"enabled":"true","scalingType":"OK","width":"97.42%","height":"72.31%","x":"2.53%","y":"22.03%"},"ver":"190104c210519","dis":false,"tt":"","a":{"columns":"date time,device number,p5 total,irleft,irright,average,mindelta,maxdelta,l1,l2,range,rebait range,takeng,location,site","text color":"#000000","row color":"#000000","display header":"true","enable search":"true","title":"Packet 6 Data","colWidths":"0.06677524429967427,0.06596091205211727,0.06758957654723127,0.06677524429967427,0.06596091205211727,0.06677524429967427,0.06677524429967427,0.06677524429967427,0.06677524429967427,0.06677524429967427,0.06596091205211727,0.06677524429967427,0.06596091205211727,0.06758957654723127,0.06677524429967427"},"ev":{"clientEvents":{"inputEvents":{"transTable6":{"channel":"deleteRows/delete all rows","event":"delete all rows","important":"false"}},"outputEvents":{"Row selected":{"channel":"rowSelected/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"Scripting#4":{"t":"Scripting","lX":155,"lY":425,"sX":1,"sY":1,"s":"Application Settings","ps":{"enabled":"false","scalingType":"OK","width":"","height":"","x":"","y":""},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\n\nClientEvents.subscribe(\"editApplicationSettings\", editApplicationSettings);\nClientEvents.subscribe(\"addApplicationSettings\", addApplicationSettings);\n\nScript.on('load', function() {\n\tDatabase.readRecords(\"rodent\", \"ApplicationSettings\", function(eventData) {\n\t\tconst applicationSettingsCollection = SensaCollection.load(eventData.value);\n\t\tconst applicationSettingsTable = Script.getWidget(\"applicationSettingsTable\");\n\t\t//id,appname,settings,value\n\t\tapplicationSettingsCollection.renameColumn(\"AppName\", \"App Name\");\n\t\tapplicationSettingsTable.receiveValue(applicationSettingsCollection);\n\t});\n});\n\nfunction editApplicationSettings(eventData) {\n    Script.setState(\"applicationSettingsData\", eventData.value);\n    Script.setState(\"modifyType\", \"edit\");\n    Client.jumpToScreen(\"Edit Application Settings\");\n}\n\n function addApplicationSettings() {\n     Script.setState(\"modifyType\", \"add\");\n     Client.jumpToScreen(\"Edit Application Settings\");\n }"},"ev":{}},"applicationSettingsTable":{"t":"Table","lX":51,"lY":110,"sX":8.77,"sY":3.15,"s":"Application Settings","ps":{"enabled":"true","scalingType":"OK","width":"69.47%","height":"43.32%","x":"4.03%","y":"15.17%"},"ver":"190104c210519","dis":false,"tt":"","a":{"text color":"#000000","row color":"#000000","columns":"id,app name,settings,value","form id":"applicationSetting","form key":"applicationSetting","selectable":"single","display header":"true","title":"Application Settings","colWidths":"0.2502857142857143,0.2502857142857143,0.24914285714285714,0.2502857142857143"},"ev":{"clientEvents":{"outputEvents":{"Edit Application Settings":{"channel":"editApplicationSettings/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"editApplicationSettings":{"t":"Container","lX":100,"lY":50,"sX":6.5,"sY":3.95,"s":"Edit Application Settings","ps":{"enabled":"true","scalingType":"OK","width":"51.46%","height":"54.41%","x":"7.92%","y":"6.89%"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"color":"grey","title":"Title"},"ev":{}},"appNameInput":{"t":"Input","lX":108,"lY":54,"sX":6.35,"sY":1,"s":"Edit Application Settings","ps":{"enabled":"true","scalingType":"NOVERT","width":"50.24%","height":"7.3%","x":"8.55%","y":"12.5%"},"ver":"270520c210519","dis":false,"tt":"","a":{"form id":"applicationSettings","form key":"AppName","label text":"App Name","color":"grey","required":"true"},"ev":{}},"Text Area#0":{"t":"Text Area","lX":108,"lY":203,"sX":6.35,"sY":1.55,"s":"Edit Application Settings","ps":{"enabled":"true","scalingType":"OK","width":"50.24%","height":"21.35%","x":"8.55%","y":"29.98%"},"ver":"190104c210519","dis":false,"tt":"","a":{"form id":"applicationSettings","form key":"Value","color":"grey","label text":"Value"},"ev":{}},"appSettingsNameInput":{"t":"Input","lX":108,"lY":140,"sX":6.35,"sY":1,"s":"Edit Application Settings","ps":{"enabled":"true","scalingType":"NOVERT","width":"50.24%","height":"7.3%","x":"8.55%","y":"21.23%"},"ver":"270520c210519","dis":false,"tt":"","a":{"form id":"applicationSettings","form key":"Settings","color":"grey","required":"true","label text":"Settings"},"ev":{}},"appSettingsEditScript":{"t":"Scripting","lX":955,"lY":50,"sX":1,"sY":1,"s":"Edit Application Settings","ps":{"enabled":"false","scalingType":"OK","width":"","height":"","x":"","y":""},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\n\nvar userId;\nvar modifyType;\nvar modelTypeId;\nvar applicationSettingsData;\n\nconst editApplicationSettings = Script.getWidget(\"editApplicationSettings\");\n//const cancelSettingsBtn = Script.getWidget(\"cancelSettingsBtn\"); //cancelSettingsBtn\nScript.on('load', function() {\n\t/**\n\tcancelSettingsBtn.subsribe(\"pressed\", ()=> {\n\t\tClient.jumpToScreen(\"Application Settings\");\n\t}); */\n\tmodifyType = Script.getState(\"modifyType\");\n\tif (modifyType == \"add\") {\n        editApplicationSettings.setTitle(\"New Application Settings\");\n    } else if (modifyType == \"edit\") {\n        applicationSettingsData = Script.getState(\"applicationSettingsData\");\n\t\teditApplicationSettings.setTitle(\"Edit Application Settings\");\n\t\tif(applicationSettingsData != null){\n\t\t\tvar applicationSettingsObj = {};\n\t\t\tapplicationSettingsObj.AppName = applicationSettingsData.getColumn(\"appname\");\n\t\t\tapplicationSettingsObj.Settings = applicationSettingsData.getColumn(\"settings\");\n\t\t\tapplicationSettingsObj.Value = applicationSettingsData.getColumn(\"value\");\n\t\t\tScript.setForm(\"applicationSettings\", applicationSettingsObj);\n\t\t\tdebugger;\n\t\t}\n    }\n});\n\nClientEvents.subscribe(\"finishEdittAppSettings\", function() {\n\tswitch (modifyType) {\n\t\tcase 'edit':\n\t\t\thandleEdit();\n\t\t\tbreak;\n\t\tcase 'add':\n\t\t\thandleCreate();\n\t\t\tbreak;\n\t}\n});\n\nfunction handleEdit() {\n\tvar formObj = Script.getFormByKey(\"applicationSettings\");\n\tif (formObj == undefined) {\n\t\talert(\"Please fill out all required fields\");\n\t\treturn;\n\t}\n\tvar dbReq = {};\n\tlet applicationSettingsData = Script.getState(\"applicationSettingsData\");\n    let modelId = applicationSettingsData.getColumn(\"id\")[0];\n\tformObj.Id = modelId;\n\tdbReq[modelId] = formObj;\n\tdebugger;\n\tDatabase.updateRecord(\"rodent\", \"ApplicationSettings\", dbReq, () => {\n\t\tClient.jumpToScreen(\"Application Settings\");\n    });\n}\n\nfunction handleCreate() {\n\tDatabase.readRecords(\"rodent\", \"ApplicationSettings\", function(eventData) {\n\t\tlet applicationSettingsCollection = SensaCollection.load(eventData.value);\n\t\tvar formObj = Script.getFormByKey(\"applicationSettings\");\n\t\tif (formObj == undefined) {\n\t\t\talert(\"Please fill out all required fields\");\n\t\t\treturn;\n\t\t}\n\t\tvar dbReq = {};\n\t\tlet id = +applicationSettingsCollection.getColumn(\"Id\").at(-1) + 1;\n\t\tformObj.Id = `${id}`;\n\t\tdbReq[id] = formObj;\n\t\tdebugger;\n\t\tDatabase.createRecords(\"rodent\", \"ApplicationSettings\", dbReq, () => {\n\t\t\tClient.jumpToScreen(\"Application Settings\");\n         });\n\t});\n}"},"ev":{}},"appSettingsSubmitButton":{"t":"Button","lX":627,"lY":382,"sX":1.06,"sY":1,"s":"Edit Application Settings","ps":{"enabled":"true","scalingType":"OK","width":"8.41%","height":"6.34%","x":"49.62%","y":"52.62%"},"ver":"190104c210519","dis":false,"tt":"","a":{"color":"orange strong","button name":"Submit"},"ev":{"clientEvents":{"outputEvents":{"Submit":{"channel":"finishEdittAppSettings/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"addApplicationSettings":{"t":"Icon","lX":119,"lY":436,"sX":1.06,"sY":1.06,"s":"Application Settings","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"4.21%","height":"7.3%","x":"4.45%","y":"60.12%"},"ver":"200628c210519","dis":false,"tt":"","a":{"outline color":"no outline","icon file":"plus-square"},"ev":{"clientEvents":{"outputEvents":{"Add Application Settings":{"channel":"addApplicationSettings/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"IsPrimaryCheck":{"t":"Input","lX":181,"lY":351,"sX":1.3,"sY":1,"s":"Edit User Role","ps":{"enabled":"true","scalingType":"NOVERT","width":"10.29%","height":"7.3%","x":"14.33%","y":"48.35%"},"ver":"270520c210519","dis":false,"tt":"","a":{"type":"checkbox","label text":"Is Primary","checkbox label side":"right","form id":"editUser","form key":"IsPrimary"},"ev":{}},"cancelRoleButton":{"t":"Button","lX":368,"lY":348,"sX":1,"sY":1,"s":"Edit User Role","ps":{"enabled":"true","scalingType":"OK","width":"7.92%","height":"6.34%","x":"29.1%","y":"47.93%"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":"Cancel"},"ev":{}},"Container#0":{"t":"Container","lX":52,"lY":147,"sX":6.44,"sY":4.3,"s":"User Access Role","ps":{"enabled":"true","scalingType":"OK","width":"50.96%","height":"59.23%","x":"4.12%","y":"20.25%"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"title":"User Access Role","color":"grey"},"ev":{}},"removeUserRole":{"t":"Icon","lX":67,"lY":521,"sX":1,"sY":1,"s":"User Access Role","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"3.96%","height":"6.89%","x":"5.3%","y":"71.76%"},"ver":"200628c210519","dis":false,"tt":"","a":{"icon file":"trash","outline color":"no outline","hover":"red"},"ev":{"clientEvents":{"outputEvents":{"New Event #1":{"channel":"deleteUserRole/receive value","event":"pressed","trigger":"pressed","important":"false"}}}}},"addNewUserRole":{"t":"Icon","lX":130,"lY":505,"sX":1,"sY":1,"s":"User Access Role","ps":{"enabled":"true","scalingType":"NOHORIZ,NOVERT","width":"3.96%","height":"6.89%","x":"10.29%","y":"71.76%"},"ver":"200628c210519","dis":false,"tt":"","a":{"icon file":"person-plus","outline color":"no outline"},"ev":{}},"userRoleScript":{"t":"Scripting","lX":40,"lY":610,"sX":1,"sY":1,"s":"User Access Role","ps":{"enabled":"false","scalingType":"OK","width":"","height":"","x":"","y":""},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\n\nvar roleData = [\n        {\n            \"TableName\": \"Sites\", // Specify the primary table used to construct the join request\n            \"Join\": 1, // Join type 1 - Inner Join, 2 - Outer Join, 3 - Left join, 4 - Right Join.\n            \"Columns\":\n            [\n            \"Id\",\n\t\t\t\"CompanyId\",\n\t\t\t\"RoleName\",\n\t\t\t\"CreatedOn\",\n\t\t\t\"CreatedBy\"\n            \n            ],\n\n }];\nvar userTable = Script.getWidget(\"userTable\");\nconst tableColumns = [\"Role Name\", \"Created On\", \"Created By\"];\nconst addUserBtn = Script.getWidget(\"addNewUserRole\");\n\nvar companyIds;\nvar companyNames;\nvar senseCollectData;\n\nClientEvents.subscribe(\"editCompanyRole\", editCompany); //deleteUserRole\nClientEvents.subscribe(\"deleteUserRole\", deleteCompany);\nScript.on('load', function() {\n\n\taddUserBtn.subscribe(\"pressed\", ()=>{\n\t\tScript.setState(\"modifierType\", \"add\");\n\t\tClient.jumpToScreen(\"Edit User Access Role\");\n\t});\n\t\n\tClientEvents.subscribe(\"clickedUser\", function(eventData){\n\t\tvar formData = Script.getFormByKey(\"userRole\");\n\t\tvar ids = formData.userRole.getColumn(\"id\");\n\t\t\n\t});\n\t\n\n\tDatabase.readRecords(\"rodent\", \"UserAccessRole\", function(eventData){\n\t\tvar companyData = SensaCollection.load(eventData.value);\n\t\t\n\t\tcompanyData.renameColumn(\"RoleName\", \"Role Name\");\n\t\tcompanyData.renameColumn(\"CreatedOn\", \"Created On\");\n\t\tcompanyData.renameColumn(\"CreatedBy\", \"Created By\");\n\t\tClientEvents.publish(\"deleteRows\", \"\");\n\t\tuserTable.receiveValue(companyData); //senseCollectData\n\t\t//compDropdown.receiveList(companyNames);\n\t});\n});\n\nfunction editCompany(eventData) {\n    Script.setState(\"userRoleData\", eventData.value);\n    Script.setState(\"modifierType\", \"edit\");\n    Client.jumpToScreen(\"Edit User Access Role\");\n}\n\n\nfunction deleteCompany() {\n    var formData = Script.getFormByKey(\"userRole\");\n    var ids = formData.userRole.getColumn(\"id\");\n    for (var i = 0; i < ids.length; i++) {\n        userTable.deleteRows(ids[i]);\n        let req = {};\n        req[{\"Id\": ids[i], \"Status\": \"0\"}] = {\"Id\": ids[i], \"Status\": \"0\"};\n        Database.updateRecord(\"rodent\", \"UserAccessRole\", req);\n    }\n}"},"ev":{}},"Label#0":{"t":"Label","lX":139,"lY":164,"sX":1.59,"sY":1.6,"s":"Edit User Access Role","ps":{"enabled":true,"scalingType":"OK","width":"12.56%","height":"5.51%","x":"11.16%","y":"22.63%"},"ver":"200124c210519","dis":false,"tt":"","a":{"font size":"14","label text":"<font size=\"6\"><b>Roles</b></font>"},"ev":{}},"Label#2":{"t":"Label","lX":145,"lY":209,"sX":2.64,"sY":0.96,"s":"Edit User Access Role","ps":{"enabled":true,"scalingType":"OK","width":"20.93%","height":"3.31%","x":"11.63%","y":"33.4%"},"ver":"200124c210519","dis":false,"tt":"","a":{"font size":"14","label text":"<font size=\"4\"><b>Hierarchy Maintainance</b></font>"},"ev":{}},"Label#3":{"t":"Label","lX":145,"lY":237,"sX":1.59,"sY":0.96,"s":"Edit User Access Role","ps":{"enabled":true,"scalingType":"OK","width":"12.56%","height":"3.31%","x":"11.63%","y":"39.57%"},"ver":"200124c210519","dis":false,"tt":"","a":{"font size":"14","label text":"<font size=\"4\">Device <b>Provisioning</b></font>"},"ev":{}},"Label#4":{"t":"Label","lX":145,"lY":341,"sX":1.53,"sY":0.96,"s":"Edit User Access Role","ps":{"enabled":true,"scalingType":"OK","width":"12.09%","height":"3.31%","x":"11.63%","y":"47.01%"},"ver":"200124c210519","dis":false,"tt":"","a":{"font size":"14","label text":"<b><font size=\"4\">Device Action</font></b>"},"ev":{}},"Label#5":{"t":"Label","lX":142,"lY":298,"sX":2.23,"sY":0.96,"s":"Edit User Access Role","ps":{"enabled":true,"scalingType":"OK","width":"17.67%","height":"3.31%","x":"11.35%","y":"53.31%"},"ver":"200124c210519","dis":false,"tt":"","a":{"font size":"14","label text":"<b><font size=\"4\">Create Site Events</font></b>"},"ev":{}},"companyDropDown":{"t":"Dropdown","lX":673,"lY":156,"sX":2.41,"sY":1,"s":"Edit User Access Role","ps":{"enabled":true,"scalingType":"NOVERT","width":"19.07%","height":"7.3%","x":"53.95%","y":"22.63%"},"ver":"190104c210519","dis":false,"tt":"","a":{"form id":"addUser","form key":"CompanyId","label text":"Company Name","bold":"true","color":"black","default options":""},"ev":{}},"Label#6":{"t":"Label","lX":662,"lY":242,"sX":1.17,"sY":0.96,"s":"Edit User Access Role","ps":{"enabled":true,"scalingType":"OK","width":"9.3%","height":"3.31%","x":"56.74%","y":"33.4%"},"ver":"200124c210519","dis":false,"tt":"","a":{"font size":"14","label text":"<b>Allow</b>"},"ev":{}},"Label#7":{"t":"Label","lX":708,"lY":287,"sX":1.17,"sY":0.96,"s":"Edit User Access Role","ps":{"enabled":true,"scalingType":"OK","width":"9.3%","height":"3.31%","x":"56.74%","y":"39.57%"},"ver":"200124c210519","dis":false,"tt":"","a":{"font size":"14","label text":"<b>Allow</b>"},"ev":{}},"Label#8":{"t":"Label","lX":708,"lY":341,"sX":1.17,"sY":0.96,"s":"Edit User Access Role","ps":{"enabled":true,"scalingType":"OK","width":"9.3%","height":"3.31%","x":"56.74%","y":"47.01%"},"ver":"200124c210519","dis":false,"tt":"","a":{"font size":"14","label text":"Allow"},"ev":{}},"Label#9":{"t":"Label","lX":708,"lY":387,"sX":1.17,"sY":0.96,"s":"Edit User Access Role","ps":{"enabled":true,"scalingType":"OK","width":"9.3%","height":"3.31%","x":"56.74%","y":"53.31%"},"ver":"200124c210519","dis":false,"tt":"","a":{"font size":"14","label text":"<b>Allow</b>"},"ev":{}},"feature01":{"t":"Input","lX":799,"lY":242,"sX":1.17,"sY":1,"s":"Edit User Access Role","ps":{"enabled":true,"scalingType":"NOVERT","width":"9.3%","height":"7.3%","x":"64%","y":"33.4%"},"ver":"270520c210519","z":"140","dis":false,"tt":"","a":{"type":"checkbox","form id":"addUser","form key":"Feature01"},"ev":{}},"feature03":{"t":"Input","lX":799,"lY":330,"sX":1.17,"sY":1,"s":"Edit User Access Role","ps":{"enabled":true,"scalingType":"NOVERT","width":"9.3%","height":"7.3%","x":"64%","y":"45.51%"},"ver":"270520c210519","z":"130","dis":false,"tt":"","a":{"type":"checkbox","form id":"addUser","form key":"Feature03"},"ev":{}},"feature04":{"t":"Input","lX":799,"lY":380,"sX":1.17,"sY":1,"s":"Edit User Access Role","ps":{"enabled":true,"scalingType":"NOVERT","width":"9.3%","height":"7.3%","x":"64%","y":"52.31%"},"ver":"270520c210519","dis":false,"tt":"","a":{"type":"checkbox","form id":"addUser","form key":"Feature04"},"ev":{}},"saveUserRoleButton":{"t":"Button","lX":789,"lY":437,"sX":1.17,"sY":1,"s":"Edit User Access Role","ps":{"enabled":true,"scalingType":"OK","width":"9.3%","height":"6.34%","x":"63.26%","y":"60.18%"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":"Save","color":"orange strong","text color":"white"},"ev":{}},"cancelUserRoleButton":{"t":"Button","lX":633,"lY":437,"sX":1.17,"sY":1,"s":"Edit User Access Role","ps":{"enabled":true,"scalingType":"OK","width":"9.3%","height":"6.34%","x":"50.7%","y":"60.18%"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":"Cancel"},"ev":{}},"userRoleAccessScript":{"t":"Scripting","lX":235,"lY":645,"sX":1,"sY":1,"s":"Edit User Access Role","ps":{"enabled":false,"scalingType":"OK","width":"4.2%","height":"11.12%","x":"9.86%","y":"71.86%"},"ver":"200124c210519","dis":false,"tt":"","a":{"script type":"javascript","code editor":"//# sourceURL=dynamic-script.js\n/**\n * Description: \n * Create Author/Date: \n * Modified Author/Date Date: \n * Version: \n */\n\n/**\n * Initialise script state (run once at startup)\n */\nconst compDropdown = Script.getWidget(\"companyDropDown\"); \nconst submitComp = Script.getWidget(\"saveUserRoleButton\");\nconst cancel = Script.getWidget(\"cancelUserRoleButton\");\nconst userRoleEditContainer = Script.getWidget(\"userRoleEditContainer\"); \nconst roleNameInput = Script.getWidget(\"roleNameInput\");\n\nconst feature01 = Script.getWidget(\"feature01\");\nconst feature02 = Script.getWidget(\"feature02\");\nconst feature03 = Script.getWidget(\"feature03\");\nconst feature04 = Script.getWidget(\"feature04\");\nconst features = [feature01, feature02,feature03, feature04];\n\nvar CompanyIds;\nvar companyNames;\nvar modifier;\nvar userData;\nvar id;\nvar companyId;\nvar roleName;\nScript.on('load', function() {\n\n\tScript.setState(\"Caller\", \"User Access Role\");\n\tmodifier = Script.getState(\"modifierType\");\n\tuserData = Script.getState(\"userRoleData\");\n\t\n\thandleModifier();\n\tcancel.subscribe(\"pressed\", (eventData) => {\n\t\tClient.jumpToScreen(\"User Access Role\");\n\t\n\t});\n\tsubmitComp.subscribe(\"pressed\", (eventData) => {\n\t\tconsole.log(\"Button pressed\");\n\t\tvar dataType = 1;\n\t\tvar formData = Script.getFormByKey(\"addUser\");\n\t\t\n\t\n\t\tif(formData === undefined){\n\t\t\talert(\"Please fill out all required fields\");\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tvar dbData = {};\n\t\t\n\t\tvar status = 1;\n\t\tvar companyName = formData.CompanyId;\n\t\tvar compIndex = companyNames.indexOf(companyName);\n\t\tvar today = new Date();\n\t\ttoday = Utils.formatDate(today, \"dd/MM/yyyy HH:mm\", false);//new Date().getTime();\n\t\t\n\t\tif(modifier === \"add\"){\n\t\t   Database.readLastPrimaryKey(\"rodent\", \"UserAccessRole\", function(eventData){\n\t\t\t//console.log(\"Last key is \" + eventData.value);\n\t\t\tvar lastId = isNaN(eventData.value) ? 1 : parseInt(eventData.value) + 1;\n\t\t\tvar dbData = {};\n\t\t\t\n\t\t\t\n\t\t\tdbData[lastId] = formData;\n\t\t\t//Database.createRecords(\"rodent\", \"UserAccessRole\", dbData, ()=>{});\n\t\t\tconsole.log(\"data to be stored \" + JSON.stringify(dbData, null, 4));\n\t\t\t\n\t\t\t\n\t\t\tDatabase.saveRecordParam(\"rodent\", \"UserAccessRole\",{ //UserAccessRole\n\t\t\t\t\n\t\t\t\tlastId: {\n\t\t\t\t\t\"Id\": lastId,\n\t\t\t\t\t\"CompanyId\": CompanyIds[compIndex],\n\t\t\t\t\t\"RoleName\": formData.RoleName,\n\t\t\t\t\t\"Status\": 1,\n\t\t\t\t\t\"CreatedBy\": Client.getUser(),\n\t\t\t\t\t\"CreatedOn\": today,\n                    \"Feature01\": +formData.Feature01,\n\t\t\t\t\t\"Feature02\": +formData.Feature02,\n\t\t\t\t\t\"Feature03\": +formData.Feature03,\n\t\t\t\t\t\"Feature04\": +formData.Feature04,\n\t\t\t\t\t\"ModifiedBy\": Client.getUser(),\n\t\t\t\t\t\"ModifiedOn\": today\n\t\t\t\t}\n\t\t\t\t}, function(dataValue) {\n\t\t\t\t//console.log(\"Data value is : \" + JSON.stringify(dataValue, null, 4));\n\t\t\t\t\t//Client.jumpToScreen(\"User Access Role\");\n\t\t\t\t\t\n\t\t\t\t}); \n\t\t\t});\n\t\t} else if (modifier === \"edit\"){\n\t\t\t\n\t\t\t//var formData = Script.getFormByKey(\"addUser\");\n\t\t\tif (formData == undefined) {\n\t\t\t\talert(\"Please fill out all required fields\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar dbReq = {};\n\t\t\tformData.Id = id;\n\t\t\t//formObj.Status = +formObj.Status;\n\t\t\tformData.RoleName = roleName;\n\t\t\tformData.CompanyId = companyId;\n\t\t\tformData.Feature01 = +formData.Feature01;\n\t\t\tformData.Feature02 = +formData.Feature02;\n\t\t\tformData.Feature03 = +formData.Feature03;\n\t\t\tformData.Feature04 = +formData.Feature04;\n\t\t\tformData.ModifiedOn = today;\n\t\t\tformData.ModifiedBy = Client.getUser();\n\t\t\tdbReq[id] = formData;\n\n\t\t\tDatabase.updateRecord(\"rodent\", \"UserAccessRole\", dbReq, () => {\n\t\t\t\tClient.jumpToScreen(\"User Access Role\");\n\t\t\t});\n\t\t}\n\t\t \n\t});\n\t\n\tDatabase.readRecords(\"rodent\", \"Companies\", function(eventData){\n\t\tvar companyData = SensaCollection.load(eventData.value);\n\t\t\n\t\t//console.log(\"company data \" + JSON.stringify(companyData, null, 4));\n\t\tcompanyNames = companyData.getColumn(\"Name\");\n\t\t\n\t\tlet compLoc = companyData.getColumn(\"Address\");\n\t\tCompanyIds = companyData.getColumn(\"Id\");\n\t\t\n\t\t//console.log(\"name data \" + JSON.stringify(companyNames, null, 4));\n\t\tif(modifier === \"edit\"){\n\t\t   for(let i = 0; i < CompanyIds.length; i++){\n\t\t\t\tif(CompanyIds[i] === companyId) {\n\t\t\t\t\tcompDropdown.receiveValue(companyNames[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tcompDropdown.receiveList(companyNames);\n\t\t}\n\t\t\n\t});\n});\n\nfunction handleModifier(){\n\n\tswitch(modifier) {\n\t\n\t\tcase \"add\":\n\t\t\t//handle add\n\t\t\tconsole.log(\"it is add\");\n\t\t\taddUserRole();\n\t\t\tbreak;\n\t\tcase \"edit\":\n\t\t\t//handle edit \n\t\t\tconsole.log(\"it is edit\");\n\t\t\teditForm();\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tconsole.log(\"go back\");\n\t\t\tClient.jumpToScreen(\"User Access Role\");\n\t\t\tbreak;\n\t}\n}\n\nfunction editForm(){\n\t userRoleEditContainer.setTitle(\"Edit User Role\");\n\t\n\tvar data = Object.values(userData.data)[0];\n\tid = data[0];\n\tcompanyId = data[1];\n\troleName = data[2];\n\troleNameInput.receiveValue(roleName);\n\t\n\tfor(let i = 0; i < features.length; i++) {\n\t\tfeatures[i].receiveValue(data[i + 3]);\n\t}\n\tvar name;\n\n    return;\n\t\n}\n\nfunction addUserRole(){\n\tuserRoleEditContainer.setTitle(\"New User Role\");\n    return;\n}"},"ev":{}},"userTable":{"t":"Table","lX":67,"lY":215,"sX":6.11,"sY":2.99,"s":"User Access Role","ps":{"enabled":"true","scalingType":"OK","width":"48.39%","height":"41.18%","x":"5.3%","y":"29.59%"},"ver":"190104c210519","dis":false,"tt":"","a":{"text color":"#000000","row color":"#000000","columns":"role name,created on,created by","selectable":"multi + single","enable search":"true","form id":"userRole","form key":"userRole","colWidths":"0.3054187192118227,0.3070607553366174,0.3054187192118227"},"ev":{"clientEvents":{"inputEvents":{"deleteUserRows":{"channel":"deleteRows/delete all rows","event":"delete all rows","important":"false"}},"outputEvents":{"clickerUser":{"channel":"clickedUser/receive value","event":"pressed","trigger":"pressed","important":"false"},"editCompanyRole":{"channel":"editCompanyRole/receive value","event":"selected","trigger":"selected","important":"false"}}}}},"userRoleEditContainer":{"t":"Container","lX":117,"lY":124,"sX":8.17,"sY":3.83,"s":"Edit User Access Role","ps":{"enabled":true,"scalingType":"OK","width":"64.65%","height":"52.75%","x":"9.4%","y":"17.13%"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"color":"grey","title":"Title"},"ev":{}},"roleNameInput":{"t":"Input","lX":424,"lY":164,"sX":2.47,"sY":1,"s":"Edit User Access Role","ps":{"enabled":true,"scalingType":"NOVERT","width":"19.53%","height":"7.3%","x":"33.95%","y":"22.63%"},"ver":"270520c210519","dis":false,"tt":"","a":{"form id":"addUser","form key":"RoleName","required":"true","label text":"Role Name"},"ev":{}},"cancelProduct":{"t":"Button","lX":285,"lY":432,"sX":1.26,"sY":1,"s":"Edit Product","ps":{"enabled":"true","scalingType":"OK","width":"9.98%","height":"6.34%","x":"22.58%","y":"59.5%"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":"Cancel"},"ev":{}},"Container#2":{"t":"Container","lX":50,"lY":20,"sX":11.53,"sY":7.1,"s":"Manage Master Products","ps":{"enabled":"true","scalingType":"OK","width":"91.29%","height":"97.8%","x":"50px","y":"16px"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"color":"grey","title":"Manage Master Products"},"ev":{}},"Container#3":{"t":"Container","lX":39,"lY":53,"sX":8.91,"sY":5.86,"s":"User Roles","ps":{"enabled":"true","scalingType":"OK","width":"70.52%","height":"80.72%","x":"3.06%","y":"7.27%"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"title":"User Roles","color":"grey"},"ev":{}},"cancelErrorCode":{"t":"Button","lX":286,"lY":547,"sX":1.15,"sY":1,"s":"Edit Error Codes","ps":{"enabled":"true","scalingType":"OK","width":"9.07%","height":"6.34%","x":"22.65%","y":"75.32%"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":"Cancel"},"ev":{}},"Container#4":{"t":"Container","lX":11,"lY":49,"sX":11.79,"sY":5.85,"s":"Error Codes","ps":{"enabled":"true","scalingType":"OK","width":"93.37%","height":"80.58%","x":"0.88%","y":"6.87%"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"title":"Error Codes","color":"grey"},"ev":{}},"Container#5":{"t":"Container","lX":48,"lY":26,"sX":11.64,"sY":6.9,"s":"Manage Companies","ps":{"enabled":"true","scalingType":"OK","width":"92.19%","height":"95.04%","x":"3.82%","y":"3.63%"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"title":"Manage Companies","color":"grey"},"ev":{}},"canceCompanyBtn":{"t":"Button","lX":323,"lY":301,"sX":1.15,"sY":1,"s":"Edit Company","ps":{"enabled":"true","scalingType":"OK","width":"9.07%","height":"6.34%","x":"26.59%","y":"41.42%"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":"Cancel"},"ev":{}},"Container#6":{"t":"Container","lX":22,"lY":17,"sX":11.62,"sY":4.74,"s":"Manage Model Types","ps":{"enabled":"true","scalingType":"OK","width":"92%","height":"65.29%","x":"1.76%","y":"2.37%"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"title":"Manage Model Type","color":"grey"},"ev":{}},"cancelModelType":{"t":"Button","lX":256,"lY":195,"sX":1.3,"sY":1,"s":"Edit Model Type","ps":{"enabled":"true","scalingType":"OK","width":"10.33%","height":"6.34%","x":"33.23%","y":"26.81%"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":"Cancel"},"ev":{}},"Container#7":{"t":"Container","lX":78,"lY":13,"sX":6.88,"sY":4.15,"s":"Manage Device Models","ps":{"enabled":"true","scalingType":"OK","width":"54.44%","height":"57.16%","x":"7.2%","y":"1.82%"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"title":"Manage Device Models","color":"grey"},"ev":{}},"cancelModelBtn":{"t":"Button","lX":424,"lY":436,"sX":1.06,"sY":1,"s":"Edit Model","ps":{"enabled":"true","scalingType":"OK","width":"8.41%","height":"6.34%","x":"33.56%","y":"59.99%"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":"Cancel"},"ev":{}},"Container#8":{"t":"Container","lX":46,"lY":72,"sX":8.89,"sY":4.34,"s":"Application Settings","ps":{"enabled":"true","scalingType":"OK","width":"70.35%","height":"59.78%","x":"3.61%","y":"9.87%"},"ver":"190104c210519","z":"100","dis":false,"tt":"","a":{"title":"Application Settings","color":"grey"},"ev":{}},"cancelSettingsBtn":{"t":"Button","lX":461,"lY":382,"sX":1.06,"sY":1,"s":"Edit Application Settings","ps":{"enabled":"true","scalingType":"OK","width":"8.41%","height":"6.34%","x":"39.51%","y":"52.62%"},"ver":"190104c210519","dis":false,"tt":"","a":{"button name":"Cancel","jump to screen":"Application Settings"},"ev":{}},"feature02":{"t":"Input","lX":817,"lY":287,"sX":1,"sY":1,"s":"Edit User Access Role","ps":{"enabled":true,"scalingType":"NOVERT","width":"7.92%","height":"7.3%","x":"65.5%","y":"39.57%"},"ver":"270520c210519","dis":false,"tt":"","a":{"type":"checkbox","form id":"addUser","form key":"Feature02"},"ev":{}}},"screens":{"Manage Products":{"index":0,"icon":"shopping_basket","meta":""},"Edit Product":{"index":1,"icon":"edit","meta":""},"Manage Master Products":{"index":2,"icon":"shopping_basket","meta":""},"User Roles":{"index":3,"icon":"verified_user","meta":""},"Edit User Role":{"index":4,"icon":"assignment_ind","meta":""},"Error Codes":{"index":5,"icon":"error","meta":""},"Edit Error Codes":{"index":6,"icon":"edit","meta":""},"Manage Companies":{"index":7,"icon":"business","meta":""},"Edit Company":{"index":8,"icon":"edit","meta":""},"Manage Model Types":{"index":9,"icon":"airplay","meta":""},"Edit Model Type":{"index":10,"icon":"create","meta":""},"Manage Device Models":{"index":11,"icon":"widgets","meta":""},"Edit Model":{"index":12,"icon":"mode_edit","meta":""},"Packet 6 Transactions":{"index":13,"icon":"data_usage","meta":""},"Application Settings":{"index":14,"icon":"widgets","meta":""},"Edit Application Settings":{"index":15,"icon":"create","meta":""},"User Access Role":{"index":16,"icon":"verified_user","meta":""},"Edit User Access Role":{"index":17,"icon":"mode_edit","meta":""}},"meta":""}